<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>LineByLine: Platform Vision Document</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      border: none;
      border-top: 1px solid #1a1a1a;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">LineByLine: Platform Vision Document</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#linebyline-a-platform-for-real-language-acquisition"
id="toc-linebyline-a-platform-for-real-language-acquisition">LineByLine:
A Platform for Real Language Acquisition</a>
<ul>
<li><a href="#table-of-contents" id="toc-table-of-contents">Table of
Contents</a></li>
<li><a href="#executive-summary" id="toc-executive-summary">Executive
Summary</a>
<ul>
<li><a href="#tech-stack" id="toc-tech-stack">Tech Stack</a></li>
<li><a href="#key-differentiators" id="toc-key-differentiators">Key
Differentiators</a></li>
</ul></li>
<li><a href="#the-problem" id="toc-the-problem">The Problem: Why
Traditional Apps Fail</a>
<ul>
<li><a href="#the-duolingo-trap" id="toc-the-duolingo-trap">The Duolingo
Trap</a></li>
<li><a href="#what-learners-actually-need"
id="toc-what-learners-actually-need">What Learners Actually
Need</a></li>
</ul></li>
<li><a href="#our-solution" id="toc-our-solution">Our Solution:
Evidence-Based Learning</a>
<ul>
<li><a href="#the-linebyline-method" id="toc-the-linebyline-method">The
LineByLine Method</a></li>
<li><a href="#why-this-works" id="toc-why-this-works">Why This
Works</a></li>
</ul></li>
<li><a href="#core-philosophy" id="toc-core-philosophy">Core Philosophy
&amp; Learning Principles</a>
<ul>
<li><a href="#comprehensible-input-i1"
id="toc-comprehensible-input-i1">1. Comprehensible Input (i+1)</a></li>
<li><a href="#spaced-repetition-fsrs-algorithm"
id="toc-spaced-repetition-fsrs-algorithm">2. Spaced Repetition (FSRS
Algorithm)</a></li>
<li><a href="#comprehensible-output" id="toc-comprehensible-output">3.
Comprehensible Output</a></li>
<li><a href="#shadowing-the-ultimate-pronunciation-tool"
id="toc-shadowing-the-ultimate-pronunciation-tool">4. Shadowing: The
Ultimate Pronunciation Tool</a></li>
<li><a href="#desirable-difficulties-bjork"
id="toc-desirable-difficulties-bjork">5. Desirable Difficulties
(Bjork)</a></li>
</ul></li>
<li><a href="#technical-architecture"
id="toc-technical-architecture">Technical Architecture</a>
<ul>
<li><a href="#system-overview" id="toc-system-overview">System
Overview</a></li>
<li><a href="#service-responsibilities"
id="toc-service-responsibilities">Service Responsibilities</a></li>
</ul></li>
<li><a href="#module-ecosystem" id="toc-module-ecosystem">Module
Ecosystem</a>
<ul>
<li><a href="#navigation-structure"
id="toc-navigation-structure">Navigation Structure</a></li>
</ul></li>
<li><a href="#vocabulary-module" id="toc-vocabulary-module">Vocabulary
Module</a>
<ul>
<li><a href="#overview" id="toc-overview">Overview</a></li>
<li><a href="#features" id="toc-features">Features</a></li>
<li><a href="#technical-implementation-details"
id="toc-technical-implementation-details">Technical Implementation
Details</a></li>
</ul></li>
<li><a href="#speaking-module" id="toc-speaking-module">Speaking
Module</a>
<ul>
<li><a href="#overview-1" id="toc-overview-1">Overview</a></li>
<li><a href="#tools" id="toc-tools">Tools</a></li>
</ul></li>
<li><a href="#writing-module" id="toc-writing-module">Writing Module</a>
<ul>
<li><a href="#overview-2" id="toc-overview-2">Overview</a></li>
<li><a href="#tools-1" id="toc-tools-1">Tools</a></li>
</ul></li>
<li><a href="#reading-module" id="toc-reading-module">Reading Module</a>
<ul>
<li><a href="#overview-3" id="toc-overview-3">Overview</a></li>
<li><a href="#features-1" id="toc-features-1">Features</a></li>
</ul></li>
<li><a href="#listening-module" id="toc-listening-module">Listening
Module</a>
<ul>
<li><a href="#overview-4" id="toc-overview-4">Overview</a></li>
<li><a href="#tools-2" id="toc-tools-2">Tools</a></li>
</ul></li>
<li><a href="#design-system" id="toc-design-system">Design System: Quiet
Immersion</a>
<ul>
<li><a href="#philosophy" id="toc-philosophy">Philosophy</a></li>
<li><a href="#color-palette" id="toc-color-palette">Color
Palette</a></li>
<li><a href="#typography" id="toc-typography">Typography</a></li>
<li><a href="#layout-system" id="toc-layout-system">Layout
System</a></li>
<li><a href="#ui-components" id="toc-ui-components">UI
Components</a></li>
<li><a href="#micro-interactions"
id="toc-micro-interactions">Micro-Interactions</a></li>
<li><a href="#accessibility"
id="toc-accessibility">Accessibility</a></li>
<li><a href="#performance-targets"
id="toc-performance-targets">Performance Targets</a></li>
</ul></li>
<li><a href="#gamification-strategy"
id="toc-gamification-strategy">Gamification Strategy</a>
<ul>
<li><a href="#philosophy-1" id="toc-philosophy-1">Philosophy</a></li>
<li><a href="#xp-system" id="toc-xp-system">XP System</a></li>
<li><a href="#streaks" id="toc-streaks">Streaks</a></li>
<li><a href="#badges" id="toc-badges">Badges</a></li>
<li><a href="#leaderboards" id="toc-leaderboards">Leaderboards</a></li>
<li><a href="#progress-visualization"
id="toc-progress-visualization">Progress Visualization</a></li>
</ul></li>
<li><a href="#ai-personalization" id="toc-ai-personalization">AI &amp;
Personalization</a>
<ul>
<li><a href="#learning-profile" id="toc-learning-profile">Learning
Profile</a></li>
<li><a href="#ai-features" id="toc-ai-features">AI Features</a></li>
</ul></li>
<li><a href="#roadmap" id="toc-roadmap">Roadmap</a>
<ul>
<li><a href="#phase-1-mvp-q4-2025-in-progress"
id="toc-phase-1-mvp-q4-2025-in-progress">Phase 1: MVP (Q4 2025) âœ… In
Progress</a></li>
<li><a href="#phase-2-enhanced-modules-q1-2026"
id="toc-phase-2-enhanced-modules-q1-2026">Phase 2: Enhanced Modules (Q1
2026)</a></li>
<li><a href="#phase-3-community-content-q2-2026"
id="toc-phase-3-community-content-q2-2026">Phase 3: Community &amp;
Content (Q2 2026)</a></li>
<li><a href="#phase-4-advanced-ai-q3-2026"
id="toc-phase-4-advanced-ai-q3-2026">Phase 4: Advanced AI (Q3
2026)</a></li>
<li><a href="#phase-5-mobile-apps-q4-2026"
id="toc-phase-5-mobile-apps-q4-2026">Phase 5: Mobile Apps (Q4
2026)</a></li>
</ul></li>
<li><a href="#success-metrics" id="toc-success-metrics">Success
Metrics</a>
<ul>
<li><a href="#learning-outcomes-primary"
id="toc-learning-outcomes-primary">Learning Outcomes (Primary)</a></li>
<li><a href="#engagement-secondary"
id="toc-engagement-secondary">Engagement (Secondary)</a></li>
<li><a href="#community-tertiary" id="toc-community-tertiary">Community
(Tertiary)</a></li>
<li><a href="#technical-infrastructure"
id="toc-technical-infrastructure">Technical (Infrastructure)</a></li>
</ul></li>
<li><a href="#conclusion" id="toc-conclusion">Conclusion</a>
<ul>
<li><a href="#what-makes-us-different"
id="toc-what-makes-us-different">What Makes Us Different</a></li>
<li><a href="#our-promise" id="toc-our-promise">Our Promise</a></li>
</ul></li>
<li><a href="#appendices" id="toc-appendices">Appendices</a>
<ul>
<li><a href="#a.-glossary-of-language-learning-terms"
id="toc-a.-glossary-of-language-learning-terms">A. Glossary of Language
Learning Terms</a></li>
<li><a href="#b.-recommended-reading" id="toc-b.-recommended-reading">B.
Recommended Reading</a></li>
<li><a href="#c.-technical-documentation-links"
id="toc-c.-technical-documentation-links">C. Technical Documentation
Links</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="linebyline-a-platform-for-real-language-acquisition">LineByLine:
A Platform for Real Language Acquisition</h1>
<blockquote>
<p><strong>Version 1.0</strong> | October 2025<br />
<em>â€œLanguage learning that respects science, not engagement
metrics.â€</em></p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#executive-summary">Executive Summary</a></li>
<li><a href="#the-problem">The Problem: Why Traditional Apps
Fail</a></li>
<li><a href="#our-solution">Our Solution: Evidence-Based
Learning</a></li>
<li><a href="#core-philosophy">Core Philosophy &amp; Learning
Principles</a></li>
<li><a href="#technical-architecture">Technical Architecture</a></li>
<li><a href="#module-ecosystem">Module Ecosystem</a>
<ul>
<li><a href="#vocabulary-module">Vocabulary Module</a></li>
<li><a href="#speaking-module">Speaking Module</a></li>
<li><a href="#writing-module">Writing Module</a></li>
<li><a href="#reading-module">Reading Module</a></li>
<li><a href="#listening-module">Listening Module</a></li>
</ul></li>
<li><a href="#design-system">Design System: Quiet Immersion</a></li>
<li><a href="#gamification-strategy">Gamification Strategy</a></li>
<li><a href="#ai-personalization">AI &amp; Personalization</a></li>
<li><a href="#roadmap">Roadmap</a></li>
<li><a href="#success-metrics">Success Metrics</a></li>
</ol>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<p><strong>LineByLine</strong> is a comprehensive language learning
platform built on proven acquisition methods, not dopamine loops. Unlike
Duolingoâ€™s gamification-first approach, we prioritize:</p>
<ul>
<li><strong>Comprehensible Input</strong> (Krashenâ€™s i+1
hypothesis)</li>
<li><strong>Spaced Repetition</strong> (FSRS algorithm for optimal
retention)</li>
<li><strong>Output Practice</strong> (speaking &amp; writing with
immediate feedback)</li>
<li><strong>Real-world content</strong> (not isolated sentences)</li>
<li><strong>Community learning</strong> (collaborative decks, shared
progress)</li>
</ul>
<h3 id="tech-stack">Tech Stack</h3>
<table style="width:100%;">
<colgroup>
<col style="width: 21%" />
<col style="width: 31%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr>
<th>Layer</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Frontend</strong></td>
<td>Next.js (React)</td>
<td>Fast, SEO-friendly, PWA-ready</td>
</tr>
<tr>
<td><strong>Backend</strong></td>
<td>ASP.NET Core</td>
<td>Robust API, auth, data management</td>
</tr>
<tr>
<td><strong>ML/AI Engine</strong></td>
<td>Python (FastAPI + gRPC)</td>
<td>FSRS scheduling, speech processing</td>
</tr>
<tr>
<td><strong>Cache/Queue</strong></td>
<td>Redis</td>
<td>Session state, real-time features</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>PostgreSQL</td>
<td>User data, decks, progress</td>
</tr>
<tr>
<td><strong>Deployment</strong></td>
<td>Docker + Compose</td>
<td>Consistent dev/prod environments</td>
</tr>
</tbody>
</table>
<h3 id="key-differentiators">Key Differentiators</h3>
<ol type="1">
<li><strong>Git-like deck versioning</strong> â€” fork, commit, merge
vocabulary sets</li>
<li><strong>FSRS 4.5 algorithm</strong> â€” scientifically optimal review
scheduling</li>
<li><strong>Modular skill system</strong> â€” master one skill at a
time</li>
<li><strong>Comprehensible input engine</strong> â€” content adapts to
your exact level</li>
<li><strong>Community-driven content</strong> â€” subscribe to
expert-curated decks</li>
</ol>
<hr />
<h2 id="the-problem">The Problem: Why Traditional Apps Fail</h2>
<h3 id="the-duolingo-trap">The Duolingo Trap</h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 29%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>What They Do</th>
<th>Why It Fails</th>
<th>Science Says</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Gamification &gt; Learning</strong></td>
<td>Streaks become the goal, not fluency</td>
<td>Extrinsic motivation fades; intrinsic motivation (understanding)
lasts</td>
</tr>
<tr>
<td><strong>Isolated sentences</strong></td>
<td>â€œThe apple is redâ€ teaches nothing useful</td>
<td>Languages need context (usage-based theory)</td>
</tr>
<tr>
<td><strong>Translation exercises</strong></td>
<td>Thinking through L1 slows acquisition</td>
<td>Direct L2 â†’ meaning mapping is faster (Krashen)</td>
</tr>
<tr>
<td><strong>Fixed review intervals</strong></td>
<td>Same timing for everyone</td>
<td>Individuals forget at different rates (Ebbinghaus curve varies)</td>
</tr>
<tr>
<td><strong>No output practice</strong></td>
<td>Passive recognition â‰  active recall</td>
<td>Output forces deeper processing (Swainâ€™s Output Hypothesis)</td>
</tr>
</tbody>
</table>
<h3 id="what-learners-actually-need">What Learners Actually Need</h3>
<p>Based on research from:</p>
<ul>
<li><strong>Stephen Krashen</strong> (Input Hypothesis)</li>
<li><strong>Paul Nation</strong> (Vocabulary acquisition)</li>
<li><strong>Merrill Swain</strong> (Output Hypothesis)</li>
<li><strong>Robert Bjork</strong> (Desirable Difficulties)</li>
</ul>
<p><strong>Successful acquisition requires:</strong></p>
<ol type="1">
<li><strong>Massive comprehensible input</strong> (listening/reading at
i+1 level)</li>
<li><strong>Spaced, interleaved practice</strong> (not massed
repetition)</li>
<li><strong>Forced output</strong> (speaking/writing with feedback)</li>
<li><strong>Emotional engagement</strong> (stories, not sentences)</li>
<li><strong>Autonomous learning</strong> (learner controls content &amp;
pace)</li>
</ol>
<hr />
<h2 id="our-solution">Our Solution: Evidence-Based Learning</h2>
<h3 id="the-linebyline-method">The LineByLine Method</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT (60% of time)                                    â”‚
â”‚  â”œâ”€ Listening: Podcasts, dialogues (with/without subs) â”‚
â”‚  â””â”€ Reading: Graded texts, authentic articles          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VOCABULARY (25% of time)                               â”‚
â”‚  â””â”€ FSRS-scheduled flashcards with context sentences   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OUTPUT (15% of time)                                   â”‚
â”‚  â”œâ”€ Speaking: Shadowing, conversation practice         â”‚
â”‚  â””â”€ Writing: Sentence construction, journaling         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="why-this-works">Why This Works</h3>
<ol type="1">
<li><strong>Input-driven</strong> â€” 60% focus on listening/reading
builds intuition</li>
<li><strong>Context-rich</strong> â€” vocabulary taught in sentences, not
isolation</li>
<li><strong>Personalized spacing</strong> â€” FSRS adapts to YOUR
memory</li>
<li><strong>Output forces consolidation</strong> â€” speaking/writing
reveals gaps</li>
<li><strong>Intrinsic motivation</strong> â€” progress measured in
comprehension, not XP</li>
</ol>
<hr />
<h2 id="core-philosophy">Core Philosophy &amp; Learning Principles</h2>
<h3 id="comprehensible-input-i1">1. Comprehensible Input (i+1)</h3>
<p><strong>Definition:</strong> Expose learners to content slightly
above their current level.</p>
<p><strong>Implementation:</strong></p>
<ul>
<li><strong>Reading Module:</strong> Texts auto-graded by known
vocabulary %
<ul>
<li>Green: 98%+ known words (easy practice)</li>
<li>Yellow: 90-97% known (optimal learning zone)</li>
<li>Red: &lt;90% known (frustration zone)</li>
</ul></li>
<li><strong>Listening Module:</strong> AI adjusts speech rate (0.7x â†’
1.3x)</li>
<li><strong>Vocabulary Module:</strong> New words appear in familiar
sentence structures</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>Current level: A2 (knows ~1500 words)

âœ… Good input: &quot;Yesterday, MarÃ­a went to the market and bought fresh vegetables.&quot;
âŒ Bad input: &quot;The photosynthetic process converts solar energy into chemical energy.&quot;</code></pre>
<h3 id="spaced-repetition-fsrs-algorithm">2. Spaced Repetition (FSRS
Algorithm)</h3>
<p><strong>Why not Ankiâ€™s SM-2?</strong></p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 8%" />
<col style="width: 38%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr>
<th>Algorithm</th>
<th>Release</th>
<th>Strengths</th>
<th>Weaknesses</th>
</tr>
</thead>
<tbody>
<tr>
<td>SM-2 (Anki)</td>
<td>1988</td>
<td>Simple, proven</td>
<td>Fixed formula, no personalization</td>
</tr>
<tr>
<td><strong>FSRS 4.5</strong></td>
<td>2023</td>
<td>Machine learning, adapts per user</td>
<td>Requires initial calibration</td>
</tr>
</tbody>
</table>
<p><strong>FSRS learns:</strong></p>
<ul>
<li>How quickly YOU forget specific card types</li>
<li>Your optimal review intervals (not averages)</li>
<li>Which cards need more frequent review</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>Python service (<code>@inclusive</code>) handles scheduling</li>
<li>Redis caches due cards for instant response</li>
<li>ASP.NET backend (<code>@personal-vocab</code>) logs reviews</li>
</ul>
<h3 id="comprehensible-output">3. Comprehensible Output</h3>
<p><strong>Theory (Swain, 1985):</strong> Producing language
(speaking/writing) helps learners:</p>
<ul>
<li>Notice gaps in knowledge</li>
<li>Test hypotheses about grammar</li>
<li>Develop fluency (automaticity)</li>
</ul>
<p><strong>Our Output Tools:</strong></p>
<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 11%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Tool</th>
<th>Skill</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Shadowing</strong></td>
<td>Speaking</td>
<td>Repeat native audio with 0-1s delay</td>
</tr>
<tr>
<td><strong>Voice Journaling</strong></td>
<td>Speaking</td>
<td>2-min daily audio diary (AI feedback)</td>
</tr>
<tr>
<td><strong>Sentence Mining</strong></td>
<td>Writing</td>
<td>Write 3 sentences using new vocabulary</td>
</tr>
<tr>
<td><strong>Conversation Simulator</strong></td>
<td>Speaking</td>
<td>AI partner adapts to your level</td>
</tr>
</tbody>
</table>
<h3 id="shadowing-the-ultimate-pronunciation-tool">4. Shadowing: The
Ultimate Pronunciation Tool</h3>
<p><strong>What is Shadowing?</strong></p>
<p>Listen to audio (speech, podcast, dialogue) and simultaneously repeat
what you hearâ€”matching:</p>
<ul>
<li>Pronunciation</li>
<li>Intonation</li>
<li>Rhythm</li>
<li>Emotion</li>
</ul>
<p><strong>Cognitive Benefits:</strong></p>
<ol type="1">
<li><strong>Phonological loop training</strong> â€” improves working
memory</li>
<li><strong>Prosody acquisition</strong> â€” natural speech patterns</li>
<li><strong>Automaticity</strong> â€” reduces cognitive load over
time</li>
</ol>
<p><strong>Implementation:</strong></p>
<pre><code>User flow:
1. Select audio (30s-2min clip)
2. Listen 1x without speaking (comprehension check)
3. Shadow 3x:
   - First: Focus on pronunciation
   - Second: Match rhythm/intonation
   - Third: Add emotion/naturalness
4. Record yourself (optional)
5. AI compares your audio to native (pronunciation score)</code></pre>
<p><strong>Content Library:</strong></p>
<ul>
<li>Movie/TV dialogues (Friends, Breaking Bad, etc.)</li>
<li>TED Talk snippets</li>
<li>Podcast clips (news, storytelling)</li>
<li>Shadowing-specific lessons (minimal music, clear speech)</li>
</ul>
<h3 id="desirable-difficulties-bjork">5. Desirable Difficulties
(Bjork)</h3>
<p><strong>Principle:</strong> Learning should feel challenging, not
easy.</p>
<p><strong>What We Avoid:</strong></p>
<ul>
<li>âŒ Multiple choice (too easy, encourages guessing)</li>
<li>âŒ Translation crutches (prevents direct L2 thinking)</li>
<li>âŒ Immediate hints (robs opportunity to struggle)</li>
</ul>
<p><strong>What We Embrace:</strong></p>
<ul>
<li>âœ… Production (type/speak the answer)</li>
<li>âœ… Interleaved practice (mix vocab, grammar, listening)</li>
<li>âœ… Delayed feedback (think before seeing answer)</li>
</ul>
<hr />
<h2 id="technical-architecture">Technical Architecture</h2>
<h3 id="system-overview">System Overview</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (Next.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Vocabulary â”‚  â”‚  Speaking  â”‚  â”‚  Reading   â”‚            â”‚
â”‚  â”‚   Module   â”‚  â”‚   Module   â”‚  â”‚   Module   â”‚  + 2 more  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ REST/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND (ASP.NET Core)                         â”‚
â”‚  â€¢ User auth (JWT)                                           â”‚
â”‚  â€¢ Deck management (CRUD, versioning)                        â”‚
â”‚  â€¢ Progress tracking (XP, streaks, badges)                   â”‚
â”‚  â€¢ Social features (leaderboards, friends)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
             â”‚ gRPC                     â”‚ Redis pub/sub
             â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ENGINE (Python)       â”‚  â”‚  REDIS                       â”‚
â”‚  â€¢ FSRS scheduling        â”‚  â”‚  â€¢ Session cache             â”‚
â”‚  â€¢ Speech-to-text         â”‚  â”‚  â€¢ Real-time updates         â”‚
â”‚  â€¢ Text difficulty calc.  â”‚  â”‚  â€¢ Due card queue            â”‚
â”‚  â€¢ Pronunciation scoring  â”‚  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ PostgreSQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABASE                 â”‚
â”‚  â€¢ Users, decks, cards    â”‚
â”‚  â€¢ Review history (FSRS)  â”‚
â”‚  â€¢ Progress logs          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="service-responsibilities">Service Responsibilities</h3>
<h4 id="frontend-next.js">1. Frontend (Next.js)</h4>
<p><strong>Location:</strong> <code>line-by-line-ui/</code></p>
<p><strong>Features:</strong></p>
<ul>
<li>Server-side rendering for SEO</li>
<li>PWA (offline study mode)</li>
<li>Real-time updates via WebSocket</li>
<li>Responsive design (mobile-first)</li>
</ul>
<p><strong>Key Pages:</strong></p>
<pre><code>/dashboard           â†’ Module selector, daily goal
/vocabulary/study    â†’ Flashcard review (FSRS)
/vocabulary/browse   â†’ Deck marketplace
/speaking/shadow     â†’ Shadowing practice
/reading/library     â†’ Graded texts
/profile/stats       â†’ Progress graphs, streaks</code></pre>
<h4 id="backend-asp.net-core">2. Backend (ASP.NET Core)</h4>
<p><strong>Location:</strong> <code>personal-vocab/</code></p>
<p><strong>Endpoints:</strong></p>
<pre><code>/api/auth              â†’ Register, login, JWT refresh
/api/decks             â†’ CRUD, fork, commit, merge
/api/cards             â†’ Add, edit, bulk import
/api/study             â†’ Get due cards, submit review
/api/progress          â†’ XP, badges, streaks
/api/social            â†’ Friends, leaderboards
/api/content           â†’ Texts, audio files (CDN proxy)</code></pre>
<p><strong>Database Schema (Key Tables):</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Users          â†’ <span class="kw">id</span>, email, xp, streak_count, settings</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Decks          â†’ <span class="kw">id</span>, owner_id, parent_deck_id (<span class="cf">for</span> forks), visibility</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>Cards          â†’ <span class="kw">id</span>, deck_id, front, back, context_sentence</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>Reviews        â†’ <span class="kw">id</span>, card_id, user_id, rating, fsrs_state</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>Subscriptions  â†’ user_id, deck_id (<span class="kw">following</span> <span class="kw">public</span> decks)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>Content        â†’ <span class="kw">id</span>, <span class="kw">type</span> (text<span class="op">/</span>audio), difficulty, language</span></code></pre></div>
<h4 id="ai-engine-python-grpc">3. AI Engine (Python + gRPC)</h4>
<p><strong>Location:</strong> <code>inclusive/</code></p>
<p><strong>Services:</strong></p>
<ol type="1">
<li><p><strong>FSRS Scheduler</strong></p>
<ul>
<li>Calculates next review date per card</li>
<li>Updates card parameters (difficulty, stability)</li>
<li>Library: <code>open-spaced-repetition/py-fsrs</code></li>
</ul></li>
<li><p><strong>Speech Processing</strong></p>
<ul>
<li>Speech-to-text (Whisper API or Azure)</li>
<li>Pronunciation scoring (phoneme comparison)</li>
<li>Voice activity detection</li>
</ul></li>
<li><p><strong>Content Analysis</strong></p>
<ul>
<li>Text difficulty scoring (based on frequency lists)</li>
<li>Sentence mining (extract example sentences)</li>
<li>Vocabulary extraction</li>
</ul></li>
</ol>
<p><strong>gRPC Proto Definition:</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode protobuf"><code class="sourceCode protobuf"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">service</span> FSRSService {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rpc</span> ScheduleCard(CardState) <span class="kw">returns</span> (NextReview);</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rpc</span> BatchSchedule(CardList) <span class="kw">returns</span> (ReviewSchedule);</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">service</span> SpeechService {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rpc</span> TranscribeAudio(AudioData) <span class="kw">returns</span> (Transcript);</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rpc</span> ScorePronunciation(PronunciationRequest) <span class="kw">returns</span> (Score);</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="module-ecosystem">Module Ecosystem</h2>
<h3 id="navigation-structure">Navigation Structure</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIDEBAR (Persistent)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š Vocabulary                  â”‚   â”‚
â”‚  â”‚  ğŸ¤ Speaking                    â”‚   â”‚
â”‚  â”‚  âœï¸  Writing                     â”‚   â”‚
â”‚  â”‚  ğŸ“– Reading                     â”‚   â”‚
â”‚  â”‚  ğŸ§ Listening                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚   â”‚
â”‚  â”‚  ğŸ“Š Progress                    â”‚   â”‚
â”‚  â”‚  ğŸ‘¥ Community                   â”‚   â”‚
â”‚  â”‚  âš™ï¸  Settings                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<hr />
<h2 id="vocabulary-module">Vocabulary Module</h2>
<h3 id="overview">Overview</h3>
<p>The foundation of language learningâ€”spaced repetition flashcards
powered by FSRS.</p>
<h3 id="features">Features</h3>
<h4 id="deck-management">1. Deck Management</h4>
<p><strong>Personal Decks:</strong></p>
<ul>
<li>Create custom decks (e.g., â€œBusiness Spanishâ€, â€œAnime
Vocabularyâ€)</li>
<li>Import from CSV, Anki (.apkg), or text files</li>
<li>Tag cards (grammar, slang, formal, etc.)</li>
</ul>
<p><strong>Public Deck Marketplace:</strong></p>
<ul>
<li>Browse community-created decks</li>
<li>Preview first 10 cards before subscribing</li>
<li>See creatorâ€™s study stats (credibility)</li>
</ul>
<p><strong>Git-like Versioning:</strong></p>
<pre><code>linebyline/spanish-1000-words (master)
â”œâ”€ kamil/spanish-1000-words-modified (fork)
â”‚  â””â”€ Added 50 regional words
â”‚  â””â”€ Fixed 3 translation errors
â””â”€ maria/spanish-1000-words-business (fork)
   â””â”€ Specialized for business contexts</code></pre>
<p><strong>Actions:</strong></p>
<ul>
<li><strong>Fork:</strong> Copy deck to your account</li>
<li><strong>Commit:</strong> Save changes with message (â€œAdded medical
termsâ€)</li>
<li><strong>Pull Request:</strong> Suggest changes to original deck</li>
<li><strong>Merge:</strong> Original creator accepts your changes</li>
</ul>
<h4 id="study-session">2. Study Session</h4>
<p><strong>Review Flow:</strong></p>
<pre><code>1. Show card front (e.g., &quot;La manzana&quot;)
2. User recalls meaning (mental effort)
3. Flip card â†’ see back (&quot;The apple&quot; + example sentence)
4. Self-rate difficulty:
   - Again (complete blank)
   - Hard (struggled to recall)
   - Good (recalled correctly)
   - Easy (instant recognition)
5. FSRS calculates next review (30m â†’ 3d â†’ 2w â†’ 4mo...)</code></pre>
<p><strong>Card Types:</strong></p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 24%" />
<col style="width: 26%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Type</th>
<th>Front</th>
<th>Back</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vocab â†’ Meaning</strong></td>
<td>L2 word</td>
<td>L1 definition + sentence</td>
<td>Recognition</td>
</tr>
<tr>
<td><strong>Meaning â†’ Vocab</strong></td>
<td>L1 definition</td>
<td>L2 word (type it)</td>
<td>Production</td>
</tr>
<tr>
<td><strong>Audio â†’ Text</strong></td>
<td>Audio clip</td>
<td>Written word</td>
<td>Listening</td>
</tr>
<tr>
<td><strong>Image â†’ Vocab</strong></td>
<td>Picture</td>
<td>L2 word</td>
<td>Direct association (no L1)</td>
</tr>
<tr>
<td><strong>Cloze</strong></td>
<td>â€œI ____ to schoolâ€</td>
<td>â€œI <strong>went</strong> to schoolâ€</td>
<td>Grammar/usage</td>
</tr>
</tbody>
</table>
<p><strong>Contextual Learning:</strong> Every card includes:</p>
<ul>
<li>Example sentence (shows word in use)</li>
<li>Audio pronunciation (native speaker)</li>
<li>Mnemonic hints (optional, user-created)</li>
</ul>
<h4 id="advanced-features">3. Advanced Features</h4>
<p><strong>Sentence Mining:</strong></p>
<ul>
<li>Import sentences from reading/listening content</li>
<li>Auto-generate flashcards from highlighted words</li>
<li>AI suggests best context sentence</li>
</ul>
<p><strong>Leech Detection:</strong></p>
<ul>
<li>Cards reviewed 8+ times without progress â†’ flagged</li>
<li>Suggests: rewrite card, add mnemonic, or suspend</li>
</ul>
<p><strong>Heatmap Progress:</strong></p>
<pre><code>GitHub-style contribution graph:

  M  T  W  T  F  S  S
 â–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘  â† Week 1
 â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘ â–ˆâ–ˆ â–ˆâ–ˆ  â† Week 2

Dark = &gt;20 cards reviewed
Light = 1-20 cards
Empty = 0 cards (streak broken!)</code></pre>
<hr />
<h3 id="technical-implementation-details">Technical Implementation
Details</h3>
<h4 id="system-architecture">System Architecture</h4>
<p><strong>Technology Stack:</strong></p>
<ul>
<li><strong>Backend Framework:</strong> ASP.NET Core 9.0 (C#)</li>
<li><strong>Database:</strong> PostgreSQL with Entity Framework
Core</li>
<li><strong>Caching Layer:</strong> Redis (StackExchange.Redis)</li>
<li><strong>AI/ML Service:</strong> Python gRPC service (FSRS
algorithm)</li>
<li><strong>Authentication:</strong> JWT Bearer tokens</li>
<li><strong>Data Mapping:</strong> AutoMapper</li>
<li><strong>API Documentation:</strong> Swagger/OpenAPI</li>
</ul>
<p><strong>Service Dependencies:</strong></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Core services registered in Program.cs</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>CardService<span class="op">&gt;();</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>DeckService<span class="op">&gt;();</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>DeckSubscriptionService<span class="op">&gt;();</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>StudySessionService<span class="op">&gt;();</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>SettingsService<span class="op">&gt;();</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Redis for session state and queue management</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddSingleton</span><span class="op">&lt;</span>IConnectionMultiplexer<span class="op">&gt;(</span>sp <span class="op">=&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> configuration <span class="op">=</span> builder<span class="op">.</span><span class="fu">Configuration</span><span class="op">.</span><span class="fu">GetSection</span><span class="op">(</span><span class="st">&quot;Redis&quot;</span><span class="op">)[</span><span class="st">&quot;ConnectionString&quot;</span><span class="op">];</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> ConnectionMultiplexer<span class="op">.</span><span class="fu">Connect</span><span class="op">(</span>configuration<span class="op">!);</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">// gRPC client for FSRS scheduling</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddGrpcClient</span><span class="op">&lt;</span>VocabService<span class="op">.</span><span class="fu">VocabServiceClient</span><span class="op">&gt;(</span>o <span class="op">=&gt;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span><span class="fu">Address</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Uri</span><span class="op">(</span>builder<span class="op">.</span><span class="fu">Configuration</span><span class="op">.</span><span class="fu">GetSection</span><span class="op">(</span><span class="st">&quot;GrpcAddresses&quot;</span><span class="op">)[</span><span class="st">&quot;Inclusive&quot;</span><span class="op">]!)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<hr />
<h4 id="api-endpoints-functionality">API Endpoints &amp;
Functionality</h4>
<p><strong>Base Path:</strong> <code>/api/v1/</code></p>
<h5 id="deck-management-apiv1deck">Deck Management
(<code>/api/v1/deck</code>)</h5>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 5%" />
<col style="width: 33%" />
<col style="width: 20%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Request Body</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/deck</code></td>
<td>POST</td>
<td>Create new deck</td>
<td><code>CreateDeckRequestDto</code></td>
<td><code>DeckDto</code></td>
</tr>
<tr>
<td><code>/deck/{deckId}</code></td>
<td>GET</td>
<td>Get deck details</td>
<td>-</td>
<td><code>DeckDto</code></td>
</tr>
<tr>
<td><code>/deck/{deckId}</code></td>
<td>PUT</td>
<td>Update deck metadata</td>
<td><code>UpdateDeckRequestDto</code></td>
<td><code>DeckDto</code></td>
</tr>
<tr>
<td><code>/deck/{deckId}</code></td>
<td>DELETE</td>
<td>Delete deck (owner only)</td>
<td>-</td>
<td><code>200 OK</code></td>
</tr>
<tr>
<td><code>/deck/my-decks</code></td>
<td>GET</td>
<td>Get userâ€™s owned/subscribed decks</td>
<td>-</td>
<td><code>List&lt;DeckDto&gt;</code></td>
</tr>
<tr>
<td><code>/deck/public</code></td>
<td>GET</td>
<td>Browse public deck marketplace</td>
<td>-</td>
<td><code>List&lt;DeckDto&gt;</code></td>
</tr>
<tr>
<td><code>/deck/{deckId}/fork</code></td>
<td>POST</td>
<td>Fork public deck to personal library</td>
<td>-</td>
<td><code>DeckDto</code> (forked copy)</td>
</tr>
</tbody>
</table>
<p><strong>Example: Create Deck</strong></p>
<pre class="http"><code>POST /api/v1/deck
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  &quot;title&quot;: &quot;Spanish Business Vocabulary&quot;,
  &quot;description&quot;: &quot;Essential terms for business meetings&quot;,
  &quot;isPublic&quot;: true
}</code></pre>
<p><strong>Example: Fork Deck</strong></p>
<pre class="http"><code>POST /api/v1/deck/abc-123-def/fork
Authorization: Bearer {jwt_token}

Response:
{
  &quot;id&quot;: &quot;xyz-456-ghi&quot;,
  &quot;title&quot;: &quot;Fork of Spanish Business Vocabulary&quot;,
  &quot;description&quot;: &quot;Essential terms for business meetings&quot;,
  &quot;isPublic&quot;: false,
  &quot;ownerId&quot;: &quot;user-789&quot;,
  &quot;parentDeckId&quot;: &quot;abc-123-def&quot;,
  &quot;createdDate&quot;: &quot;2025-11-01T10:30:00Z&quot;,
  &quot;cardCount&quot;: 150,
  &quot;isSubscribed&quot;: false
}</code></pre>
<h5 id="card-management-apiv1card">Card Management
(<code>/api/v1/card</code>)</h5>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 5%" />
<col style="width: 30%" />
<col style="width: 20%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Request Body</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/card</code></td>
<td>POST</td>
<td>Add card to deck</td>
<td><code>CreateCardRequestDto</code></td>
<td><code>CardDto</code></td>
</tr>
<tr>
<td><code>/card/{cardId}</code></td>
<td>GET</td>
<td>Get card with progress</td>
<td>-</td>
<td><code>CardDto</code></td>
</tr>
<tr>
<td><code>/card/{cardId}</code></td>
<td>PUT</td>
<td>Update card content</td>
<td><code>UpdateCardRequestDto</code></td>
<td><code>CardDto</code></td>
</tr>
<tr>
<td><code>/card/{cardId}</code></td>
<td>DELETE</td>
<td>Delete card (creator only)</td>
<td>-</td>
<td><code>200 OK</code></td>
</tr>
<tr>
<td><code>/card/{deckId}/cards</code></td>
<td>GET</td>
<td>Get all cards in deck</td>
<td>-</td>
<td><code>List&lt;CardDto&gt;</code></td>
</tr>
<tr>
<td><code>/card/all</code></td>
<td>GET</td>
<td>Get all userâ€™s cards (table view)</td>
<td>-</td>
<td><code>List&lt;CardTableRowDto&gt;</code></td>
</tr>
<tr>
<td><code>/card/due</code></td>
<td>GET</td>
<td>Check if cards due</td>
<td>Query params</td>
<td><code>{ hasDueCards: bool }</code></td>
</tr>
<tr>
<td><code>/card/next/{sessionId}</code></td>
<td>GET</td>
<td>Get next card in study session</td>
<td>-</td>
<td><code>CardDto</code></td>
</tr>
<tr>
<td><code>/card/review/{cardId}</code></td>
<td>POST</td>
<td>Submit review (FSRS update)</td>
<td><code>ReviewCardRequestDto</code></td>
<td><code>ReviewResponseDto</code></td>
</tr>
</tbody>
</table>
<p><strong>Query Parameters for <code>/card/due</code>:</strong></p>
<ul>
<li><code>deckId</code> (optional): Filter by specific deck</li>
<li><code>sortBy</code> (optional): <code>"createdDate"</code> |
<code>"deckId"</code> | <code>"nextReviewDate"</code></li>
<li><code>skill</code> (optional): <code>"Reading"</code> |
<code>"Writing"</code> | <code>"Speaking"</code> |
<code>"Listening"</code></li>
<li><code>mode</code> (optional): <code>"Learn"</code> |
<code>"Review"</code> | <code>"Cram"</code></li>
</ul>
<p><strong>Example: Submit Review</strong></p>
<pre class="http"><code>POST /api/v1/card/review/card-123
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  &quot;quality&quot;: 3  // 1=Again, 2=Hard, 3=Good, 4=Easy
}

Response:
{
  &quot;card&quot;: {
    &quot;id&quot;: &quot;card-123&quot;,
    &quot;front&quot;: &quot;La manzana&quot;,
    &quot;back&quot;: &quot;The apple&quot;,
    &quot;progress&quot;: {
      &quot;due&quot;: &quot;2025-11-05T10:00:00Z&quot;,  // Next review date
      &quot;stability&quot;: 5.2,
      &quot;difficulty&quot;: 6.8,
      &quot;state&quot;: 2,  // Review state
      &quot;reps&quot;: 5    // Total repetitions
    }
  }
}</code></pre>
<h5 id="study-sessions-apiv1study">Study Sessions
(<code>/api/v1/study</code>)</h5>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 5%" />
<col style="width: 24%" />
<col style="width: 21%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Request Body</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/study/start</code></td>
<td>POST</td>
<td>Initialize study session</td>
<td><code>StartSessionRequestDto</code></td>
<td><code>{ sessionId: guid }</code></td>
</tr>
<tr>
<td><code>/study/end/{sessionId}</code></td>
<td>POST</td>
<td>End session, get statistics</td>
<td>-</td>
<td><code>EndStudySessionResponseDto</code></td>
</tr>
<tr>
<td><code>/study/{sessionId}</code></td>
<td>GET</td>
<td>Get session details</td>
<td>-</td>
<td><code>StudySessionDto</code></td>
</tr>
<tr>
<td><code>/study/{sessionId}/check</code></td>
<td>GET</td>
<td>Check if session active</td>
<td>-</td>
<td><code>{ active: bool }</code></td>
</tr>
<tr>
<td><code>/study/{sessionId}/stats</code></td>
<td>GET</td>
<td>Get live session statistics</td>
<td>-</td>
<td><code>CardStatsDto</code></td>
</tr>
</tbody>
</table>
<p><strong>Study Session Lifecycle:</strong></p>
<pre><code>1. START SESSION â†’ Creates session, populates Redis queues
   â”œâ”€ Fetches due cards (FSRS Due &lt; Tomorrow)
   â”œâ”€ Fetches new cards (up to DailyNewCardLimit)
   â”œâ”€ Separates into 3 queues: learning, new, review
   â””â”€ Returns sessionId

2. GET NEXT CARD â†’ Pop from priority queue
   â”œâ”€ Priority: Learning &gt; New &gt; Review
   â”œâ”€ Checks daily limits (new/review)
   â””â”€ Returns CardDto or null (session complete)

3. SUBMIT REVIEW â†’ gRPC call to FSRS service
   â”œâ”€ Calculate next review date
   â”œâ”€ Update UserCardProgress (difficulty, stability)
   â”œâ”€ Increment daily counters
   â”œâ”€ Re-queue if due today (learning â†’ review transition)
   â””â”€ Update session stats (Redis cache)

4. END SESSION â†’ Finalize metrics
   â”œâ”€ Save session stats to DB
   â”œâ”€ Clear Redis queues
   â””â”€ Return summary (totalCardsReviewed, averageQuality)</code></pre>
<p><strong>Example: Start Session</strong></p>
<pre class="http"><code>POST /api/v1/study/start
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  &quot;deckId&quot;: &quot;deck-123&quot;
}

Response:
{
  &quot;sessionId&quot;: &quot;session-789&quot;
}</code></pre>
<p><strong>Example: Get Session Stats</strong></p>
<pre class="http"><code>GET /api/v1/study/session-789/stats
Authorization: Bearer {jwt_token}

Response:
{
  &quot;newCount&quot;: 8,       // Cards user hasn&#39;t seen
  &quot;learningCount&quot;: 5,  // Cards in learning phase (multiple reviews today)
  &quot;reviewCount&quot;: 23    // Cards due for review
}</code></pre>
<h5 id="deck-subscriptions-apiv1deck-subscription">Deck Subscriptions
(<code>/api/v1/deck-subscription</code>)</h5>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 6%" />
<col style="width: 27%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/deck-subscription/{deckId}</code></td>
<td>POST</td>
<td>Subscribe to public deck</td>
<td><code>DeckSubscriptionDto</code></td>
</tr>
<tr>
<td><code>/deck-subscription/{deckId}</code></td>
<td>DELETE</td>
<td>Unsubscribe from deck</td>
<td><code>200 OK</code></td>
</tr>
<tr>
<td><code>/deck-subscription</code></td>
<td>GET</td>
<td>Get all subscribed decks</td>
<td><code>List&lt;DeckSubscriptionDto&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Subscription vs.Â Fork:</strong></p>
<ul>
<li><strong>Subscribe:</strong> Follow public deck, receive updates
(read-only)</li>
<li><strong>Fork:</strong> Create personal copy, full edit permissions,
no updates</li>
</ul>
<h5 id="deck-versioning-apiv1deck-version">Deck Versioning
(<code>/api/v1/deck-version</code>)</h5>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 7%" />
<col style="width: 25%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/deck-version/deck/{deckId}</code></td>
<td>GET</td>
<td>Get version history</td>
<td><code>List&lt;DeckVersionDto&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Version tracking enables:</strong></p>
<ul>
<li>Commit messages (â€œAdded 50 medical termsâ€)</li>
<li>Change attribution (ModifiedByUserId)</li>
<li>Rollback capability (SnapshotJson)</li>
<li>Pull request workflow (future feature)</li>
</ul>
<hr />
<h4 id="data-models">Data Models</h4>
<h5 id="core-entities">Core Entities</h5>
<p><strong>Deck Entity:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Deck</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Title <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> Description <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> ImageUrl <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> IsPublic <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid OwnerId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid<span class="op">?</span> ParentDeckId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>  <span class="co">// For forked decks</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime<span class="op">?</span> LastReviewedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">[]</span> Tags <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>  <span class="co">// [&quot;Spanish&quot;, &quot;Business&quot;]</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Navigation properties</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Deck<span class="op">?</span> ParentDeck <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> ICollection<span class="op">&lt;</span>Card<span class="op">&gt;</span> Cards <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> ICollection<span class="op">&lt;</span>DeckVersion<span class="op">&gt;</span> Versions <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> ICollection<span class="op">&lt;</span>DeckSubscription<span class="op">&gt;</span> Subscriptions <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Card Entity:</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Card</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Front <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>           <span class="co">// L2 word or phrase</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Back <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>            <span class="co">// L1 translation/definition</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> Hint <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>           <span class="co">// Mnemonic or grammar tip</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> MediaUrl <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>       <span class="co">// Audio/image URL</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> SkillType Skill <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>        <span class="co">// Reading/Writing/Speaking/Listening</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid DeckId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid CreatorId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Navigation properties</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Deck Deck <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> ICollection<span class="op">&lt;</span>UserCardProgress<span class="op">&gt;</span> Progress <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> SkillType</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    Reading<span class="op">,</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    Writing<span class="op">,</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    Speaking<span class="op">,</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    Listening</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>UserCardProgress (extends FSRS Card):</strong></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> UserCardProgress <span class="op">:</span> DotnetFSRS<span class="op">.</span><span class="fu">Card</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid UserId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid CardId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> LastQuality <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>  <span class="co">// 1-4 (Again/Hard/Good/Easy)</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Inherited from FSRS Card:</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - Due (DateTime): Next review date</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - Stability (float): Memory strength</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - Difficulty (float): Card intrinsic difficulty (0-10)</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - State (enum): New, Learning, Review, Relearning</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - Reps (int): Total review count</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - Lapses (int): Times user clicked &quot;Again&quot;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - LastReview (DateTime): Last review timestamp</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Card Card <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>StudySession Entity:</strong></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StudySession</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid UserId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid DeckId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime StartTime <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime<span class="op">?</span> EndTime <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> AverageQuality <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>       <span class="co">// Mean quality (1-4)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> TotalCardsReviewed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> ICollection<span class="op">&lt;</span>ReviewedCard<span class="op">&gt;</span> ReviewedCards <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ReviewedCard</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid StudySessionId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid CardId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> Quality <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime ReviewedAt <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> StudySession StudySession <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Card Card <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>UserSettings Entity:</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> UserSettings</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid UserId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> DailyNewCardLimit <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> DailyReviewLimit <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> NewCardsCompletedToday <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> ReviewsCompletedToday <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> RolloverHour <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>       <span class="co">// Day starts at 4 AM</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime LastResetDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> LearningMode PreferredMode <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>  <span class="co">// Learn/Review/Cram</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> LearningMode</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    Learn<span class="op">,</span>   <span class="co">// Only new cards (up to DailyNewCardLimit)</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    Review<span class="op">,</span>  <span class="co">// Prioritize reviews, then new cards (default)</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    Cram     <span class="co">// All cards in deck, ignore FSRS (for testing)</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>DeckVersion Entity:</strong></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DeckVersion</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid DeckId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> ChangeDescription <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>    <span class="co">// Commit message</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid ModifiedByUserId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime ModifiedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> SnapshotJson <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span>        <span class="co">// Full deck state (optional)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Deck Deck <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>DeckSubscription Entity:</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DeckSubscription</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid UserId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Guid DeckId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime SubscribedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">virtual</span> Deck Deck <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h4 id="fsrs-integration-grpc">FSRS Integration (gRPC)</h4>
<p><strong>Proto Definition (<code>Vocab.proto</code>):</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode protobuf"><code class="sourceCode protobuf"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>syntax <span class="op">=</span> <span class="st">&quot;proto3&quot;</span>;</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> vocab;</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">service</span> VocabService {</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rpc</span> ReviewCard (ReviewRequest) <span class="kw">returns</span> (ReviewResponse) {}</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> ReviewRequest {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  Card card <span class="op">=</span> <span class="dv">1</span>;                                <span class="co">// Current FSRS state</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> quality <span class="op">=</span> <span class="dv">2</span>;                            <span class="co">// 1-4 (Again/Hard/Good/Easy)</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Int32Value review_duration <span class="op">=</span> <span class="dv">3</span>;  <span class="co">// Seconds spent reviewing</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> ReviewResponse {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  Card card <span class="op">=</span> <span class="dv">1</span>;        <span class="co">// Updated FSRS state</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  ReviewLog review_log <span class="op">=</span> <span class="dv">2</span>;</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> Card {</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> state <span class="op">=</span> <span class="dv">1</span>;                              <span class="co">// 0=New, 1=Learning, 2=Review, 3=Relearning</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Int32Value step <span class="op">=</span> <span class="dv">2</span>;          <span class="co">// Current step in learning phase</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  google.protobuf.FloatValue stability <span class="op">=</span> <span class="dv">3</span>;     <span class="co">// Memory stability</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  google.protobuf.FloatValue difficulty <span class="op">=</span> <span class="dv">4</span>;    <span class="co">// Intrinsic difficulty (0-10)</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Timestamp due <span class="op">=</span> <span class="dv">5</span>;            <span class="co">// Next review date</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Timestamp last_review <span class="op">=</span> <span class="dv">6</span>;</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> ReviewLog {</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> rating <span class="op">=</span> <span class="dv">2</span>;</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Timestamp review_datetime <span class="op">=</span> <span class="dv">3</span>;</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Int32Value review_duration <span class="op">=</span> <span class="dv">4</span>;</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>FSRS State Machine:</strong></p>
<pre><code>NEW â†’ (First review)
  â”œâ”€ Again (1) â†’ LEARNING (step 1, due in 1 min)
  â”œâ”€ Hard (2)  â†’ LEARNING (step 1, due in 5 min)
  â”œâ”€ Good (3)  â†’ LEARNING (step 2, due in 10 min)
  â””â”€ Easy (4)  â†’ REVIEW (due in 4 days)

LEARNING â†’ (Subsequent reviews within day)
  â”œâ”€ Again â†’ LEARNING (reset to step 1)
  â”œâ”€ Hard  â†’ LEARNING (same step, shorter interval)
  â”œâ”€ Good  â†’ LEARNING (next step)
  â””â”€ Easy  â†’ REVIEW (graduate early)

REVIEW â†’ (Mature cards)
  â”œâ”€ Again â†’ RELEARNING (due in 10 min)
  â”œâ”€ Hard  â†’ REVIEW (interval Ã— 1.2)
  â”œâ”€ Good  â†’ REVIEW (interval Ã— 2.5)
  â””â”€ Easy  â†’ REVIEW (interval Ã— 5.0)

RELEARNING â†’ (Lapsed cards)
  â”œâ”€ Again â†’ RELEARNING (step 1)
  â”œâ”€ Hard  â†’ RELEARNING (same step)
  â”œâ”€ Good  â†’ RELEARNING (next step)
  â””â”€ Easy  â†’ REVIEW (graduate)</code></pre>
<p><strong>gRPC Call Flow:</strong></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In CardService.SubmitReviewAsync()</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> reviewRequest <span class="op">=</span> <span class="kw">new</span> ReviewRequest</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    Card <span class="op">=</span> _mapper<span class="op">.</span><span class="fu">Map</span><span class="op">&lt;</span>Vocab<span class="op">.</span><span class="fu">Card</span><span class="op">&gt;(</span>progress<span class="op">),</span>  <span class="co">// Map UserCardProgress â†’ gRPC Card</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    Quality <span class="op">=</span> request<span class="op">.</span><span class="fu">Quality</span>                  <span class="co">// 1-4</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> reviewResponse <span class="op">=</span> await _vocabServiceClient<span class="op">.</span><span class="fu">ReviewCardAsync</span><span class="op">(</span>reviewRequest<span class="op">);</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>progress <span class="op">=</span> _mapper<span class="op">.</span><span class="fu">Map</span><span class="op">(</span>reviewResponse<span class="op">.</span><span class="fu">Card</span><span class="op">,</span> progress<span class="op">);</span>  <span class="co">// Update UserCardProgress</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>await _dbContext<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span></code></pre></div>
<p><strong>FSRS Advantages:</strong></p>
<ul>
<li><strong>Personalized:</strong> Learns userâ€™s forgetting curve
(stability parameter adapts)</li>
<li><strong>Efficient:</strong> Fewer reviews for same retention
vs.Â SM-2</li>
<li><strong>Research-backed:</strong> Based on 20,000+ usersâ€™ review
data</li>
</ul>
<hr />
<h4 id="fsrs-configuration-parameters-anki-compatible">FSRS
Configuration &amp; Parameters (Anki-Compatible)</h4>
<p><strong>Current Configuration Location:</strong>
<code>inclusive/config.json</code></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;server_port&quot;</span><span class="fu">:</span> <span class="dv">40051</span><span class="fu">,</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;fsrs&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;request_retention&quot;</span><span class="fu">:</span> <span class="fl">0.9</span><span class="fu">,</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;maximum_interval&quot;</span><span class="fu">:</span> <span class="dv">36500</span><span class="fu">,</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;w&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.4072</span><span class="ot">,</span> <span class="fl">1.1829</span><span class="ot">,</span> <span class="fl">3.1262</span><span class="ot">,</span> <span class="fl">15.4722</span><span class="ot">,</span> <span class="fl">7.2102</span><span class="ot">,</span> <span class="fl">0.5316</span><span class="ot">,</span> <span class="fl">1.0651</span><span class="ot">,</span> <span class="fl">0.0234</span><span class="ot">,</span> <span class="fl">1.616</span><span class="ot">,</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.1544</span><span class="ot">,</span> <span class="fl">1.0824</span><span class="ot">,</span> <span class="fl">1.9813</span><span class="ot">,</span> <span class="fl">0.0953</span><span class="ot">,</span> <span class="fl">0.2975</span><span class="ot">,</span> <span class="fl">2.2042</span><span class="ot">,</span> <span class="fl">0.2407</span><span class="ot">,</span> <span class="fl">2.9466</span><span class="ot">,</span> <span class="fl">0.5034</span><span class="ot">,</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.6567</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;enable_fuzz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;enable_short_term&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h5 id="fsrs-parameters-explained">FSRS Parameters Explained</h5>
<p><strong>1. <code>request_retention</code> (Default: 0.9)</strong></p>
<ul>
<li><strong>What it is</strong>: Target retention rate (90%)</li>
<li><strong>Anki equivalent</strong>: Desired retention in deck
options</li>
<li><strong>Effect</strong>: Higher values = shorter intervals (more
frequent reviews)</li>
<li><strong>Range</strong>: 0.7 - 0.97</li>
<li><strong>Recommendation</strong>:
<ul>
<li>0.9 (90%) - Balanced (default, same as Anki)</li>
<li>0.85 (85%) - Fewer reviews, longer intervals</li>
<li>0.95 (95%) - More reviews, better retention</li>
</ul></li>
</ul>
<p><strong>2. <code>maximum_interval</code> (Default: 36500
days)</strong></p>
<ul>
<li><strong>What it is</strong>: Maximum number of days between reviews
(~100 years)</li>
<li><strong>Anki equivalent</strong>: Maximum interval in deck
options</li>
<li><strong>Effect</strong>: Caps how long a card can be scheduled
for</li>
<li><strong>Recommendation</strong>:
<ul>
<li>36500 - Effectively unlimited (default)</li>
<li>365 - Maximum 1 year between reviews</li>
<li>180 - Maximum 6 months for professional knowledge</li>
</ul></li>
</ul>
<p><strong>3. <code>w</code> (Weights Array)</strong></p>
<ul>
<li><strong>What it is</strong>: 19 algorithm parameters that define the
scheduling behavior</li>
<li><strong>Anki equivalent</strong>: FSRS-5 algorithm weights</li>
<li><strong>Current values</strong>: Optimized default parameters from
FSRS research</li>
<li><strong>Source</strong>: Based on analysis of millions of Anki
reviews</li>
<li><strong>DO NOT MODIFY</strong> unless you have custom optimization
data</li>
</ul>
<p><strong>Weight Parameters (for reference):</strong></p>
<pre><code>w[0-3]:   Initial stability for Again, Hard, Good, Easy on new cards
w[4-7]:   Initial difficulty for Again, Hard, Good, Easy
w[8]:     Difficulty decay rate
w[9]:     Stability increase for Easy bonus
w[10]:    Hard penalty
w[11-14]: Stability factors for ratings
w[15-16]: Retrievability factors
w[17-18]: Advanced scheduling parameters</code></pre>
<p><strong>4. <code>enable_fuzz</code> (Default: true)</strong></p>
<ul>
<li><strong>What it is</strong>: Randomizes review times slightly
(Â±5%)</li>
<li><strong>Anki equivalent</strong>: Same as Ankiâ€™s fuzzing</li>
<li><strong>Benefits</strong>:
<ul>
<li>Prevents many cards from being due on the same day</li>
<li>More natural review distribution</li>
<li>Reduces workload spikes</li>
</ul></li>
<li><strong>Example</strong>: 10-day interval becomes 9.5-10.5 days
randomly</li>
</ul>
<p><strong>5. <code>enable_short_term</code> (Default:
true)</strong></p>
<ul>
<li><strong>What it is</strong>: Optimizes scheduling for short-term
learning</li>
<li><strong>Benefits</strong>:
<ul>
<li>Better handling of learning phase cards</li>
<li>More accurate predictions for new cards</li>
<li>Improved graduation timing</li>
</ul></li>
<li><strong>Keep enabled</strong> for best Anki-like experience</li>
</ul>
<h5 id="key-fsrs-concepts">Key FSRS Concepts</h5>
<p><strong>1. Stability</strong></p>
<ul>
<li>Represents how well you know the card</li>
<li>Higher stability = longer intervals</li>
<li>Increased by successful reviews</li>
<li>Decreased by failures</li>
<li>Range: 0.1 days to maximum_interval</li>
</ul>
<p><strong>2. Difficulty</strong></p>
<ul>
<li>Inherent difficulty of the card</li>
<li>Based on your historical performance</li>
<li>Range: 1 (easy) to 10 (hard)</li>
<li>Affects interval calculations</li>
<li>Updates gradually over time</li>
</ul>
<p><strong>3. Retrievability</strong></p>
<ul>
<li>Probability youâ€™ll recall the card</li>
<li>Calculated from stability and time elapsed</li>
<li>Drives the scheduling algorithm</li>
<li>Target: request_retention (e.g., 90%)</li>
</ul>
<h5 id="interval-examples">Interval Examples</h5>
<p><strong>New Card First Review:</strong></p>
<pre><code>Rating Again: Learning (10 minutes)
Rating Hard:  Learning (10 minutes)
Rating Good:  Learning â†’ 1 day
Rating Easy:  Review â†’ 4 days (graduate immediately)</code></pre>
<p><strong>Learning Card (1 day interval):</strong></p>
<pre><code>Rating Again: Back to step 1 (10 minutes)
Rating Hard:  Same step or slight increase
Rating Good:  Graduate to Review (2-3 days)
Rating Easy:  Graduate to Review (4 days)</code></pre>
<p><strong>Review Card (10 days interval):</strong></p>
<pre><code>Rating Again: Relearning (10 minutes)
Rating Hard:  Review (5-8 days)
Rating Good:  Review (20-30 days)
Rating Easy:  Review (25-40 days)</code></pre>
<p><strong>Review Card (100 days interval):</strong></p>
<pre><code>Rating Again: Relearning (10 minutes)
Rating Hard:  Review (50-80 days)
Rating Good:  Review (200-300 days)
Rating Easy:  Review (250-400 days)</code></pre>
<h5 id="comparison-with-anki-fsrs">Comparison with Anki FSRS</h5>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Anki FSRS</th>
<th>LineByLine</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Algorithm</td>
<td>FSRS v5.0</td>
<td>FSRS v6.1.0</td>
<td>âœ… Better</td>
</tr>
<tr>
<td>Card States</td>
<td>4 states</td>
<td>4 states</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Quality Ratings</td>
<td>1-4</td>
<td>1-4</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Retention Target</td>
<td>0.9 (90%)</td>
<td>0.9 (90%)</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Maximum Interval</td>
<td>36500</td>
<td>36500 days</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Fuzzing</td>
<td>âœ… Yes</td>
<td>âœ… Yes</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Short-term</td>
<td>âœ… Yes</td>
<td>âœ… Yes</td>
<td>âœ… Match</td>
</tr>
<tr>
<td>Learning Steps</td>
<td>Manual</td>
<td>FSRS-optimized</td>
<td>âœ… Better</td>
</tr>
<tr>
<td>Graduation</td>
<td>Manual</td>
<td>Automatic</td>
<td>âœ… Better</td>
</tr>
</tbody>
</table>
<h5 id="customizing-fsrs-parameters">Customizing FSRS Parameters</h5>
<p><strong>Conservative Learning (More Reviews):</strong></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;request_retention&quot;</span><span class="fu">:</span> <span class="fl">0.95</span><span class="fu">,</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;maximum_interval&quot;</span><span class="fu">:</span> <span class="dv">180</span><span class="fu">,</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_fuzz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_short_term&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Aggressive Learning (Fewer Reviews):</strong></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;request_retention&quot;</span><span class="fu">:</span> <span class="fl">0.85</span><span class="fu">,</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;maximum_interval&quot;</span><span class="fu">:</span> <span class="dv">36500</span><span class="fu">,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_fuzz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_short_term&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Exam Preparation (Short-term):</strong></p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;request_retention&quot;</span><span class="fu">:</span> <span class="fl">0.95</span><span class="fu">,</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;maximum_interval&quot;</span><span class="fu">:</span> <span class="dv">30</span><span class="fu">,</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_fuzz&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_short_term&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Language Learning (Balanced):</strong></p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;request_retention&quot;</span><span class="fu">:</span> <span class="fl">0.9</span><span class="fu">,</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;maximum_interval&quot;</span><span class="fu">:</span> <span class="dv">365</span><span class="fu">,</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_fuzz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;enable_short_term&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h5 id="when-to-change-parameters">When to Change Parameters</h5>
<p><strong>âœ… Safe to Change:</strong></p>
<ul>
<li><code>request_retention</code> - Adjust based on workload</li>
<li><code>maximum_interval</code> - Based on material type</li>
<li><code>enable_fuzz</code> - Personal preference</li>
</ul>
<p><strong>âš ï¸ Advanced Users Only:</strong></p>
<ul>
<li><code>w</code> (weights) - Only if you have custom optimization
data</li>
<li>Requires analysis of thousands of reviews</li>
<li>Use FSRS optimizer:
https://github.com/open-spaced-repetition/fsrs-optimizer</li>
</ul>
<p><strong>âŒ Donâ€™t Change:</strong></p>
<ul>
<li><code>enable_short_term</code> - Keep enabled (better learning)</li>
</ul>
<h5 id="applying-configuration-changes">Applying Configuration
Changes</h5>
<p><strong>1. Edit Configuration:</strong></p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit inclusive/config.json</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> inclusive/config.json</span></code></pre></div>
<p><strong>2. Restart FSRS Service:</strong></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Docker</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> restart inclusive</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or rebuild if needed</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> <span class="at">--build</span> inclusive</span></code></pre></div>
<p><strong>3. Verify Changes:</strong></p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check logs</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs inclusive <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> 50</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Should show: &quot;Server starting on port 40051...&quot;</span></span></code></pre></div>
<h5 id="monitoring-optimization">Monitoring &amp; Optimization</h5>
<p>After 1000+ reviews, you can analyze your data:</p>
<ol type="1">
<li>Export your review history</li>
<li>Use FSRS optimizer:
https://github.com/open-spaced-repetition/fsrs-optimizer</li>
<li>Get custom weights optimized for YOUR learning patterns</li>
<li>Update <code>w</code> array in config.json</li>
</ol>
<p><strong>Expected Results (90% retention):</strong></p>
<ul>
<li><strong>New cards</strong>: 10-15 reviews to reach 100+ day
intervals</li>
<li><strong>Learning phase</strong>: 1-3 sessions</li>
<li><strong>Workload</strong>: ~10 reviews per 100 cards per day (steady
state)</li>
<li><strong>Retention</strong>: ~90% accuracy on reviews</li>
</ul>
<h5 id="troubleshooting">Troubleshooting</h5>
<p><strong>Cards reviewing too often:</strong> â†’ Decrease
<code>request_retention</code> to 0.85</p>
<p><strong>Cards reviewing too rarely (forgetting):</strong> â†’ Increase
<code>request_retention</code> to 0.95</p>
<p><strong>Too many cards due on same day:</strong> â†’ Ensure
<code>enable_fuzz</code> is true</p>
<p><strong>New cards graduating too quickly/slowly:</strong> â†’ Keep
defaults, FSRS auto-optimizes</p>
<p><strong>Very old cards (years):</strong> â†’ Adjust
<code>maximum_interval</code> if needed</p>
<hr />
<h4 id="redis-based-session-management">Redis-Based Session
Management</h4>
<p><strong>Why Redis?</strong></p>
<ul>
<li><strong>Speed:</strong> Sub-millisecond queue operations
(LPUSH/RPOP)</li>
<li><strong>Session isolation:</strong> Each study session has dedicated
queues</li>
<li><strong>Expiration:</strong> Auto-cleanup after 24 hours (prevents
memory leak)</li>
<li><strong>Real-time stats:</strong> Instant card count updates without
DB queries</li>
</ul>
<p><strong>Queue Structure:</strong></p>
<pre><code>Redis Keys per Session:
â”œâ”€ new:{sessionId}        â†’ List of new cards (JSON)
â”œâ”€ learning:{sessionId}   â†’ List of learning cards (JSON)
â”œâ”€ review:{sessionId}     â†’ List of review cards (JSON)
â””â”€ stats:{sessionId}      â†’ Cached stats (JSON, TTL=24h)

Example:
new:abc-123-def â†’ [&quot;{ &#39;id&#39;: &#39;card-1&#39;, &#39;front&#39;: &#39;hello&#39;, ... }&quot;, ...]</code></pre>
<p><strong>Session Initialization:</strong></p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">// StudySessionService.StartSessionAsync()</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Check user <span class="fu">settings</span> <span class="op">(</span>DailyNewCardLimit<span class="op">,</span> DailyReviewLimit<span class="op">)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Query PostgreSQL<span class="op">:</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> New cards<span class="op">:</span> Cards without UserCardProgress</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Due cards<span class="op">:</span> UserCardProgress<span class="op">.</span><span class="fu">Due</span> <span class="op">&lt;</span> Tomorrow</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Separate due cards by state<span class="op">:</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Learning<span class="op">:</span> State <span class="op">=</span> Learning or Relearning</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Review<span class="op">:</span> State <span class="op">=</span> Review</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Push to Redis<span class="op">:</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> LPUSH <span class="kw">new</span><span class="op">:{</span>sessionId<span class="op">}</span> <span class="op">[</span>card1<span class="op">,</span> card2<span class="op">,</span> <span class="op">...]</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> LPUSH learning<span class="op">:{</span>sessionId<span class="op">}</span> <span class="op">[</span>card3<span class="op">,</span> card4<span class="op">,</span> <span class="op">...]</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> LPUSH review<span class="op">:{</span>sessionId<span class="op">}</span> <span class="op">[</span>card5<span class="op">,</span> card6<span class="op">,</span> <span class="op">...]</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> Cache stats<span class="op">:</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> SETEX stats<span class="op">:{</span>sessionId<span class="op">}</span> <span class="dv">86400</span> <span class="op">{</span> newCount<span class="op">,</span> learningCount<span class="op">,</span> reviewCount <span class="op">}</span></span></code></pre></div>
<p><strong>Card Retrieval (Priority System):</strong></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// StudySessionService.GetNextCardAsync()</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Priority<span class="op">:</span> Learning <span class="op">&gt;</span> New <span class="op">&gt;</span> Review</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Try RPOP learning<span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>   â”œâ”€ If card returned<span class="op">:</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>   â”‚  â”œâ”€ Check<span class="op">:</span> Due <span class="op">&lt;</span> Tomorrow <span class="op">&amp;&amp;</span> ReviewsCompletedToday <span class="op">&lt;</span> DailyReviewLimit</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>   â”‚  â””â”€ Return card OR retry next queue</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>   â””â”€ If empty<span class="op">,</span> <span class="kw">try</span> next queue</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Try RPOP <span class="kw">new</span><span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>   â”œâ”€ Check<span class="op">:</span> NewCardsCompletedToday <span class="op">&lt;</span> DailyNewCardLimit</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>   â””â”€ Return card OR retry next queue</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Try RPOP review<span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>   â”œâ”€ Check<span class="op">:</span> Due <span class="op">&lt;</span> Tomorrow <span class="op">&amp;&amp;</span> ReviewsCompletedToday <span class="op">&lt;</span> DailyReviewLimit</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>   â””â”€ Return card OR <span class="kw">return</span> <span class="kw">null</span> <span class="op">(</span>session complete<span class="op">)</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> If <span class="kw">null</span><span class="op">:</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>   â”œâ”€ Set session<span class="op">.</span><span class="fu">EndTime</span> <span class="op">=</span> NOW</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>   â””â”€ Clear Redis queues</span></code></pre></div>
<p><strong>Dynamic Re-Queuing:</strong></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// After review submission</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">If</span> <span class="op">(</span>card state changed <span class="op">&amp;&amp;</span> next review due today<span class="op">):</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">If</span> <span class="op">(</span>Learning â†’ Review<span class="op">):</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        LPUSH review<span class="op">:{</span>sessionId<span class="op">}</span> card</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    Else <span class="fu">If</span> <span class="op">(</span>Review â†’ Learning<span class="op">):</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        LPUSH learning<span class="op">:{</span>sessionId<span class="op">}</span> card</span></code></pre></div>
<p><strong>Session Stats Caching:</strong></p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cached to avoid expensive COUNT queries</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;newCount&quot;</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;learningCount&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;reviewCount&quot;</span><span class="op">:</span> <span class="dv">23</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Updated after each review:</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> NewCount decrements when <span class="kw">new</span> card reviewed</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> LearningCount increments<span class="op">/</span>decrements based on state transitions</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ReviewCount decrements when review card completed</span></code></pre></div>
<p><strong>Session Cleanup:</strong></p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// StudySessionService.EndSessionAsync()</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Save session stats to PostgreSQL<span class="op">:</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> TotalCardsReviewed</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> <span class="fu">AverageQuality</span> <span class="op">(</span>mean of all ratings <span class="dv">1-4</span><span class="op">)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> <span class="fu">ReviewedCards</span> <span class="op">(</span>audit trail<span class="op">)</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Clear Redis keys<span class="op">:</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> DEL <span class="kw">new</span><span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> DEL learning<span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> DEL review<span class="op">:{</span>sessionId<span class="op">}</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> DEL stats<span class="op">:{</span>sessionId<span class="op">}</span></span></code></pre></div>
<hr />
<h4 id="daily-limits-rollover-logic">Daily Limits &amp; Rollover
Logic</h4>
<p><strong>User Settings:</strong></p>
<ul>
<li><code>DailyNewCardLimit</code>: Max new cards per day (default:
10)</li>
<li><code>DailyReviewLimit</code>: Max reviews per day (default:
100)</li>
<li><code>RolloverHour</code>: Day starts at this hour UTC (default: 4
AM)
<ul>
<li>Why 4 AM? Users study late night; rollover at midnight would
interrupt sessions</li>
</ul></li>
</ul>
<p><strong>Counter Reset Logic:</strong></p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">ResetDailyCounters</span><span class="op">(</span>UserSettings settings<span class="op">)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">var</span> <span class="op">(</span>startOfToday<span class="op">,</span> _<span class="op">)</span> <span class="op">=</span> <span class="fu">GetDayBoundaries</span><span class="op">(</span>settings<span class="op">);</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>settings<span class="op">.</span><span class="fu">LastResetDate</span> <span class="op">&lt;</span> startOfToday<span class="op">)</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        settings<span class="op">.</span><span class="fu">NewCardsCompletedToday</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        settings<span class="op">.</span><span class="fu">ReviewsCompletedToday</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        settings<span class="op">.</span><span class="fu">LastResetDate</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="op">(</span>DateTime<span class="op">,</span> DateTime<span class="op">)</span> <span class="fu">GetDayBoundaries</span><span class="op">(</span>UserSettings settings<span class="op">)</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    DateTime now <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    DateTime startOfToday <span class="op">=</span> now<span class="op">.</span><span class="fu">Date</span><span class="op">.</span><span class="fu">AddHours</span><span class="op">(</span>settings<span class="op">.</span><span class="fu">RolloverHour</span><span class="op">);</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If before rollover hour, &quot;today&quot; is actually yesterday&#39;s session</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>now <span class="op">&lt;</span> startOfToday<span class="op">)</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        startOfToday <span class="op">=</span> startOfToday<span class="op">.</span><span class="fu">AddDays</span><span class="op">(-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    DateTime startOfTomorrow <span class="op">=</span> startOfToday<span class="op">.</span><span class="fu">AddDays</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">(</span>startOfToday<span class="op">,</span> startOfTomorrow<span class="op">);</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Example:</strong></p>
<pre><code>RolloverHour = 4
Current Time: Nov 1, 2025 02:30 AM UTC

GetDayBoundaries():
  startOfToday   = Oct 31, 2025 04:00 AM UTC
  startOfTomorrow = Nov 1, 2025 04:00 AM UTC

Cards due: UserCardProgress.Due &lt; Nov 1, 04:00 AM
// This means cards due at 3:59 AM on Nov 1 are still &quot;due today&quot;</code></pre>
<p><strong>Limit Enforcement:</strong></p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In SubmitReviewAsync()</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> isNewCard <span class="op">=</span> progress <span class="op">==</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>isNewCard <span class="op">&amp;&amp;</span> settings<span class="op">.</span><span class="fu">NewCardsCompletedToday</span> <span class="op">&gt;=</span> settings<span class="op">.</span><span class="fu">DailyNewCardLimit</span><span class="op">)</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">&quot;Daily new card limit reached&quot;</span><span class="op">);</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(!</span>isNewCard <span class="op">&amp;&amp;</span> settings<span class="op">.</span><span class="fu">ReviewsCompletedToday</span> <span class="op">&gt;=</span> settings<span class="op">.</span><span class="fu">DailyReviewLimit</span><span class="op">)</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">&quot;Daily review limit reached&quot;</span><span class="op">);</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">// After successful review:</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>isNewCard<span class="op">)</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    settings<span class="op">.</span><span class="fu">NewCardsCompletedToday</span><span class="op">++;</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="kw">else</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    settings<span class="op">.</span><span class="fu">ReviewsCompletedToday</span><span class="op">++;</span></span></code></pre></div>
<hr />
<h4 id="learning-modes">Learning Modes</h4>
<p><strong>1. Review Mode (Default)</strong></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>LearningMode<span class="op">.</span><span class="fu">Review</span><span class="op">:</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  Priority<span class="op">:</span> Due reviews <span class="op">&gt;</span> New cards</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  Limits<span class="op">:</span> Respect DailyNewCardLimit <span class="op">+</span> DailyReviewLimit</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  Queue order<span class="op">:</span> learning â†’ <span class="kw">new</span> â†’ review</span></code></pre></div>
<p><strong>Use case:</strong> Balanced learning (maintain existing
knowledge + add new)</p>
<p><strong>2. Learn Mode</strong></p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>LearningMode<span class="op">.</span><span class="fu">Learn</span><span class="op">:</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  Priority<span class="op">:</span> New cards only</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  Limits<span class="op">:</span> <span class="fu">DailyNewCardLimit</span> <span class="op">(</span>ignore reviews<span class="op">)</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  Queue order<span class="op">:</span> <span class="kw">new</span> only</span></code></pre></div>
<p><strong>Use case:</strong> Rapid vocabulary building (beginner
phase)</p>
<p><strong>3. Cram Mode</strong></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>LearningMode<span class="op">.</span><span class="fu">Cram</span><span class="op">:</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  Priority<span class="op">:</span> All cards <span class="kw">in</span> deck</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  Limits<span class="op">:</span> <span class="fu">None</span> <span class="op">(</span>ignore FSRS due dates <span class="op">+</span> daily limits<span class="op">)</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  Sort by<span class="op">:</span> CreatedDate or DeckId</span></code></pre></div>
<p><strong>Use case:</strong> Pre-exam review, deck preview</p>
<p><strong>Switching Modes:</strong></p>
<pre class="http"><code>PUT /api/v1/settings
{
  &quot;preferredMode&quot;: &quot;Cram&quot;
}</code></pre>
<hr />
<h4 id="database-schema-postgresql">Database Schema (PostgreSQL)</h4>
<p><strong>Key Tables:</strong></p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Users managed by auth service (not shown)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Decks</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> Decks (</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    Title <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    Description TEXT,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    ImageUrl <span class="dt">VARCHAR</span>(<span class="dv">500</span>),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    IsPublic <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    OwnerId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    ParentDeckId UUID,  <span class="co">-- FK to Decks.Id (for forks)</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    CreatedDate <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    LastReviewedDate <span class="dt">TIMESTAMP</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    Tags <span class="dt">VARCHAR</span>(<span class="dv">50</span>)[],  <span class="co">-- PostgreSQL array</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (ParentDeckId) <span class="kw">REFERENCES</span> Decks(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">SET</span> <span class="kw">NULL</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- Cards</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> Cards (</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    Front <span class="dt">VARCHAR</span>(<span class="dv">500</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    Back <span class="dt">VARCHAR</span>(<span class="dv">500</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    Hint TEXT,</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    MediaUrl <span class="dt">VARCHAR</span>(<span class="dv">500</span>),</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    Skill <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,  <span class="co">-- Enum: 0=Reading, 1=Writing, 2=Speaking, 3=Listening</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    DeckId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    CreatedDate <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    CreatorId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (DeckId) <span class="kw">REFERENCES</span> Decks(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="co">-- User Card Progress (FSRS state)</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> UserCardProgress (</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    UserId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    CardId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- FSRS fields</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    Due <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    Stability <span class="dt">FLOAT</span>,</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    Difficulty <span class="dt">FLOAT</span>,</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    State <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,        <span class="co">-- 0=New, 1=Learning, 2=Review, 3=Relearning</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    LastReview <span class="dt">TIMESTAMP</span>,</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    Reps <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    Lapses <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    ElapsedDays <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    ScheduledDays <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    LastQuality <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (CardId) <span class="kw">REFERENCES</span> Cards(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(UserId, CardId)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_user_due <span class="kw">ON</span> UserCardProgress(UserId, Due);</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a><span class="co">-- Study Sessions</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> StudySessions (</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    UserId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    DeckId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>    StartTime <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>    EndTime <span class="dt">TIMESTAMP</span>,</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>    AverageQuality <span class="dt">FLOAT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>    TotalCardsReviewed <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (DeckId) <span class="kw">REFERENCES</span> Decks(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span></span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> ReviewedCards (</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    StudySessionId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>    CardId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>    Quality <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>    ReviewedAt <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (StudySessionId) <span class="kw">REFERENCES</span> StudySessions(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (CardId) <span class="kw">REFERENCES</span> Cards(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span></span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a><span class="co">-- User Settings</span></span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> UserSettings (</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>    UserId UUID <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">UNIQUE</span>,</span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>    DailyNewCardLimit <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">10</span>,</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>    DailyReviewLimit <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">100</span>,</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>    NewCardsCompletedToday <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>    ReviewsCompletedToday <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>    RolloverHour <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">4</span>,</span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>    LastResetDate <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a>    PreferredMode <span class="dt">INT</span> <span class="kw">DEFAULT</span> <span class="dv">1</span>  <span class="co">-- 0=Learn, 1=Review, 2=Cram</span></span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a><span class="co">-- Deck Subscriptions</span></span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> DeckSubscriptions (</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>    UserId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>    DeckId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>    SubscribedDate <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (DeckId) <span class="kw">REFERENCES</span> Decks(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(UserId, DeckId)</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a><span class="co">-- Deck Versions (Git-like commits)</span></span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> DeckVersions (</span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>    DeckId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a>    ChangeDescription <span class="dt">VARCHAR</span>(<span class="dv">500</span>),</span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a>    ModifiedByUserId UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a>    ModifiedDate <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a>    SnapshotJson TEXT,  <span class="co">-- Optional full deck snapshot</span></span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (DeckId) <span class="kw">REFERENCES</span> Decks(<span class="kw">Id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span></span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<hr />
<h4 id="performance-optimizations">Performance Optimizations</h4>
<p><strong>1. Eager Loading (Avoid N+1 Queries):</strong></p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cards <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Cards</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Include</span><span class="op">(</span>c <span class="op">=&gt;</span> c<span class="op">.</span><span class="fu">Deck</span><span class="op">)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Include</span><span class="op">(</span>c <span class="op">=&gt;</span> c<span class="op">.</span><span class="fu">Progress</span><span class="op">.</span><span class="fu">Where</span><span class="op">(</span>p <span class="op">=&gt;</span> p<span class="op">.</span><span class="fu">UserId</span> <span class="op">==</span> userId<span class="op">))</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ToListAsync</span><span class="op">();</span></span></code></pre></div>
<p><strong>2. Pagination (Future):</strong></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> decks <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Decks</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Where</span><span class="op">(</span>d <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">IsPublic</span><span class="op">)</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Skip</span><span class="op">((</span>page <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> pageSize<span class="op">)</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Take</span><span class="op">(</span>pageSize<span class="op">)</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ToListAsync</span><span class="op">();</span></span></code></pre></div>
<p><strong>3. Redis Caching:</strong></p>
<ul>
<li>Session card queues (avoid repeated DB queries)</li>
<li>Session stats (updated after each review, not recomputed)</li>
</ul>
<p><strong>4. Index Optimization:</strong></p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_user_due <span class="kw">ON</span> UserCardProgress(UserId, Due);</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_deck_public <span class="kw">ON</span> Decks(IsPublic) <span class="kw">WHERE</span> IsPublic <span class="op">=</span> <span class="kw">TRUE</span>;</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_card_deck <span class="kw">ON</span> Cards(DeckId);</span></code></pre></div>
<p><strong>5. Transaction Isolation:</strong></p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In SubmitReviewAsync() - prevent race conditions</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="dt">var</span> transaction <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Database</span><span class="op">.</span><span class="fu">BeginTransactionAsync</span><span class="op">();</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update progress</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update settings counters</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-queue card if needed</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    await _dbContext<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    await transaction<span class="op">.</span><span class="fu">CommitAsync</span><span class="op">();</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    await transaction<span class="op">.</span><span class="fu">RollbackAsync</span><span class="op">();</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span><span class="op">;</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h4 id="error-handling-validation">Error Handling &amp; Validation</h4>
<p><strong>Common Error Scenarios:</strong></p>
<ol type="1">
<li><strong>Invalid Review Quality:</strong></li>
</ol>
<div class="sourceCode" id="cb61"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>request<span class="op">.</span><span class="fu">Quality</span> <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">||</span> request<span class="op">.</span><span class="fu">Quality</span> <span class="op">&gt;</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">ArgumentException</span><span class="op">(</span><span class="st">&quot;Quality must be 1-4&quot;</span><span class="op">);</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Daily Limit Exceeded:</strong></li>
</ol>
<div class="sourceCode" id="cb62"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>settings<span class="op">.</span><span class="fu">NewCardsCompletedToday</span> <span class="op">&gt;=</span> settings<span class="op">.</span><span class="fu">DailyNewCardLimit</span><span class="op">)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">&quot;Daily new card limit reached&quot;</span><span class="op">);</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>Card Not Due:</strong></li>
</ol>
<div class="sourceCode" id="cb63"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>progress<span class="op">.</span><span class="fu">Due</span> <span class="op">&gt;=</span> startOfTomorrow<span class="op">)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">&quot;Card not due today&quot;</span><span class="op">);</span></span></code></pre></div>
<ol start="4" type="1">
<li><strong>Unauthorized Access:</strong></li>
</ol>
<div class="sourceCode" id="cb64"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> deck <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Decks</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">FirstOrDefaultAsync</span><span class="op">(</span>d <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Id</span> <span class="op">==</span> deckId <span class="op">&amp;&amp;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>d<span class="op">.</span><span class="fu">IsPublic</span> <span class="op">||</span> d<span class="op">.</span><span class="fu">OwnerId</span> <span class="op">==</span> userId <span class="op">||</span> d<span class="op">.</span><span class="fu">Subscriptions</span><span class="op">.</span><span class="fu">Any</span><span class="op">(</span>s <span class="op">=&gt;</span> s<span class="op">.</span><span class="fu">UserId</span> <span class="op">==</span> userId<span class="op">)));</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>deck <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="fu">Unauthorized</span><span class="op">();</span></span></code></pre></div>
<ol start="5" type="1">
<li><strong>Session Mismatch:</strong></li>
</ol>
<div class="sourceCode" id="cb65"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>card<span class="op">.</span><span class="fu">DeckId</span> <span class="op">!=</span> activeSession<span class="op">.</span><span class="fu">DeckId</span><span class="op">)</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">&quot;Card does not belong to active session&#39;s deck&quot;</span><span class="op">);</span></span></code></pre></div>
<p><strong>Logging Strategy:</strong></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>_logger<span class="op">.</span><span class="fu">LogInformation</span><span class="op">(</span><span class="st">&quot;User {UserId} started session {SessionId} on deck {DeckId}&quot;</span><span class="op">,</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    userId<span class="op">,</span> sessionId<span class="op">,</span> deckId<span class="op">);</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>_logger<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">&quot;Session {SessionId}: Invalid card JSON or deck mismatch&quot;</span><span class="op">,</span> sessionId<span class="op">);</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>_logger<span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>ex<span class="op">,</span> <span class="st">&quot;Error fetching next card for session {SessionId}&quot;</span><span class="op">,</span> sessionId<span class="op">);</span></span></code></pre></div>
<hr />
<h4 id="future-enhancements">Future Enhancements</h4>
<p><strong>1. Bulk Import:</strong></p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>POST <span class="op">/</span>api<span class="op">/</span>v1<span class="op">/</span>card<span class="op">/</span>bulk</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;deckId&quot;</span><span class="op">:</span> <span class="st">&quot;deck-123&quot;</span><span class="op">,</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;cards&quot;</span><span class="op">:</span> <span class="op">[</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;front&quot;</span><span class="op">:</span> <span class="st">&quot;hello&quot;</span><span class="op">,</span> <span class="st">&quot;back&quot;</span><span class="op">:</span> <span class="st">&quot;hola&quot;</span> <span class="op">},</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;front&quot;</span><span class="op">:</span> <span class="st">&quot;goodbye&quot;</span><span class="op">,</span> <span class="st">&quot;back&quot;</span><span class="op">:</span> <span class="st">&quot;adiÃ³s&quot;</span> <span class="op">}</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... up to 1000 cards</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">]</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>2. Card Contributions (Pull Requests):</strong></p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>POST <span class="op">/</span>api<span class="op">/</span>v1<span class="op">/</span>contribution</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;deckId&quot;</span><span class="op">:</span> <span class="st">&quot;public-deck-123&quot;</span><span class="op">,</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;cardId&quot;</span><span class="op">:</span> <span class="st">&quot;card-456&quot;</span><span class="op">,</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;suggestedChanges&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;front&quot;</span><span class="op">:</span> <span class="st">&quot;corrected spelling&quot;</span><span class="op">,</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;back&quot;</span><span class="op">:</span> <span class="st">&quot;better translation&quot;</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rationale&quot;</span><span class="op">:</span> <span class="st">&quot;The current translation is outdated&quot;</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>3. Deck Analytics:</strong></p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>v1<span class="op">/</span>deck<span class="op">/</span>deck<span class="dv">-123</span><span class="op">/</span>analytics</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>Response<span class="op">:</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;totalSubscribers&quot;</span><span class="op">:</span> <span class="dv">1240</span><span class="op">,</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;averageRetention&quot;</span><span class="op">:</span> <span class="fl">0.87</span><span class="op">,</span>      <span class="co">// 87% cards retained after 30 days</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;completionRate&quot;</span><span class="op">:</span> <span class="fl">0.65</span><span class="op">,</span>        <span class="co">// 65% users complete all cards</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;popularCards&quot;</span><span class="op">:</span> <span class="op">[</span>              <span class="co">// Most favorited/bookmarked</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="st">&quot;cardId&quot;</span><span class="op">:</span> <span class="st">&quot;...&quot;</span><span class="op">,</span> <span class="st">&quot;votes&quot;</span><span class="op">:</span> <span class="dv">89</span> <span class="op">}</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">]</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>4. AI-Generated Hints:</strong></p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>POST <span class="op">/</span>api<span class="op">/</span>v1<span class="op">/</span>card<span class="op">/</span>card<span class="dv">-123</span><span class="op">/</span>generate<span class="op">-</span>hint</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>Response<span class="op">:</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hint&quot;</span><span class="op">:</span> <span class="st">&quot;Think of &#39;manzana&#39; like &#39;Manzanita&#39; (little apple brand)&quot;</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>5. Voice Recording for Cards:</strong></p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>POST <span class="op">/</span>api<span class="op">/</span>v1<span class="op">/</span>card<span class="op">/</span>card<span class="dv">-123</span><span class="op">/</span>upload<span class="op">-</span>audio</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>Content<span class="op">-</span>Type<span class="op">:</span> multipart<span class="op">/</span>form<span class="op">-</span>data</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>Response<span class="op">:</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;mediaUrl&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.linebyline.com/audio/card-123.mp3&quot;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h4 id="security-considerations">Security Considerations</h4>
<p><strong>1. JWT Authentication:</strong></p>
<ul>
<li>All endpoints require <code>[Authorize]</code> attribute</li>
<li>Token expiration: 24 hours (configurable)</li>
<li>Refresh token mechanism (separate endpoint)</li>
</ul>
<p><strong>2. Authorization Checks:</strong></p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Deck ownership</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> deck <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Decks</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">FirstOrDefaultAsync</span><span class="op">(</span>d <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Id</span> <span class="op">==</span> deckId <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="fu">OwnerId</span> <span class="op">==</span> userId<span class="op">);</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Card access (owner, subscriber, or public)</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> card <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Cards</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Include</span><span class="op">(</span>c <span class="op">=&gt;</span> c<span class="op">.</span><span class="fu">Deck</span><span class="op">)</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">FirstOrDefaultAsync</span><span class="op">(</span>c <span class="op">=&gt;</span> c<span class="op">.</span><span class="fu">Id</span> <span class="op">==</span> cardId <span class="op">&amp;&amp;</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>c<span class="op">.</span><span class="fu">Deck</span><span class="op">.</span><span class="fu">IsPublic</span> <span class="op">||</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>         c<span class="op">.</span><span class="fu">Deck</span><span class="op">.</span><span class="fu">OwnerId</span> <span class="op">==</span> userId <span class="op">||</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>         c<span class="op">.</span><span class="fu">Deck</span><span class="op">.</span><span class="fu">Subscriptions</span><span class="op">.</span><span class="fu">Any</span><span class="op">(</span>s <span class="op">=&gt;</span> s<span class="op">.</span><span class="fu">UserId</span> <span class="op">==</span> userId<span class="op">)));</span></span></code></pre></div>
<p><strong>3. Rate Limiting (TODO):</strong></p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Prevent abuse of public deck creation</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddRateLimiter</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">AddFixedWindowLimiter</span><span class="op">(</span><span class="st">&quot;deck-creation&quot;</span><span class="op">,</span> opt <span class="op">=&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        opt<span class="op">.</span><span class="fu">Window</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        opt<span class="op">.</span><span class="fu">PermitLimit</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// Max 5 decks per hour</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<p><strong>4. Input Validation:</strong></p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Sanitize user input (prevent XSS)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>deck<span class="op">.</span><span class="fu">Title</span> <span class="op">=</span> HtmlEncoder<span class="op">.</span><span class="fu">Default</span><span class="op">.</span><span class="fu">Encode</span><span class="op">(</span>request<span class="op">.</span><span class="fu">Title</span><span class="op">);</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>card<span class="op">.</span><span class="fu">Front</span> <span class="op">=</span> HtmlEncoder<span class="op">.</span><span class="fu">Default</span><span class="op">.</span><span class="fu">Encode</span><span class="op">(</span>request<span class="op">.</span><span class="fu">Front</span><span class="op">);</span></span></code></pre></div>
<p><strong>5. SQL Injection Prevention:</strong></p>
<ul>
<li>Entity Framework parameterizes all queries automatically</li>
<li>Never use raw SQL with string concatenation</li>
</ul>
<hr />
<h2 id="speaking-module">Speaking Module</h2>
<h3 id="overview-1">Overview</h3>
<p>Move from silent learner to confident speaker through progressive
output practice.</p>
<h3 id="tools">Tools</h3>
<h4 id="shadowing-studio">1. Shadowing Studio</h4>
<p><strong>Purpose:</strong> Master pronunciation, intonation, and
rhythm.</p>
<p><strong>Content Types:</strong></p>
<ul>
<li><strong>Dialogues:</strong> Movie/TV scenes (2-person
conversations)</li>
<li><strong>Monologues:</strong> TED Talks, speeches (1-person)</li>
<li><strong>Music:</strong> Songs with clear lyrics (karaoke mode)</li>
<li><strong>Podcasts:</strong> News clips, storytelling</li>
</ul>
<p><strong>Interface:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¬ Friends S01E01 - Coffee Shop Scene     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                            â”‚
â”‚  [====â—================] 0:32 / 1:45      â”‚
â”‚                                            â”‚
â”‚  ğŸ”Š &quot;How you doin&#39;?&quot;                       â”‚
â”‚  ğŸ‘‚ Listen â”‚ ğŸ¤ Shadow â”‚ ğŸ“Š Compare        â”‚
â”‚                                            â”‚
â”‚  Transcript (Toggle):                      â”‚
â”‚  Rachel: &quot;How you doin&#39;?&quot;                  â”‚
â”‚  Joey: &quot;How YOU doin&#39;?&quot;                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Shadowing Modes:</strong></p>
<ol type="1">
<li><strong>Chorus Mode:</strong> Audio + your voice simultaneously</li>
<li><strong>Delay Mode:</strong> Hear phrase â†’ repeat 1s later</li>
<li><strong>Solo Mode:</strong> Muted audio, you fill the silence</li>
</ol>
<p><strong>AI Feedback:</strong></p>
<ul>
<li>Pronunciation score (0-100)</li>
<li>Highlighted mispronounced phonemes</li>
<li>Rhythm match (visual waveform comparison)</li>
</ul>
<h4 id="conversation-simulator">2. Conversation Simulator</h4>
<p><strong>Purpose:</strong> Practice real dialogues without human
pressure.</p>
<p><strong>How It Works:</strong></p>
<pre><code>AI Persona: Maria (Spanish teacher, friendly, patient)

Maria: &quot;Hola! Â¿CÃ³mo estÃ¡s hoy?&quot;
  â†“
[You speak your response via microphone]
  â†“
AI transcribes + analyzes your Spanish
  â†“
Maria: &quot;Â¡Bien! EscuchÃ© que dijiste &#39;estoy cansado&#39;.
        Â¿Trabajaste mucho hoy?&quot;</code></pre>
<p><strong>Difficulty Levels:</strong></p>
<ul>
<li><strong>A1:</strong> Simple Q&amp;A (name, hobbies, weather)</li>
<li><strong>B1:</strong> Roleplay (restaurant, shopping,
directions)</li>
<li><strong>C1:</strong> Debate topics (politics, philosophy,
ethics)</li>
</ul>
<p><strong>Adaptive Conversation:</strong></p>
<ul>
<li>AI detects hesitation â†’ simplifies next question</li>
<li>AI detects fluency â†’ increases complexity</li>
</ul>
<h4 id="voice-journaling">3. Voice Journaling</h4>
<p><strong>Purpose:</strong> Build speaking confidence through daily
reflection.</p>
<p><strong>Prompt Examples:</strong></p>
<ul>
<li>â€œDescribe your day in 2 minutes.â€</li>
<li>â€œWhatâ€™s a childhood memory?â€</li>
<li>â€œConvince me to visit your hometown.â€</li>
</ul>
<p><strong>AI Analysis:</strong></p>
<ul>
<li>Speech rate (words per minute)</li>
<li>Filler words (um, uh, like) frequency</li>
<li>Grammar errors (auto-detected)</li>
<li>Vocabulary diversity (unique words used)</li>
</ul>
<p><strong>Progress Graph:</strong></p>
<pre><code>Speaking Fluency Over 30 Days

150 wpm â”¤                            â•­â”€â—
        â”‚                        â•­â”€â”€â”€â•¯
100 wpm â”¤                 â•­â”€â”€â—â”€â”€â•¯
        â”‚          â•­â”€â”€â—â”€â”€â”€â•¯
 50 wpm â”¤    â—â”€â—â”€â”€â”€â•¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Day 1  10  20  30</code></pre>
<hr />
<h2 id="writing-module">Writing Module</h2>
<h3 id="overview-2">Overview</h3>
<p>Develop written fluency from sentence construction to essay
composition.</p>
<h3 id="tools-1">Tools</h3>
<h4 id="sentence-builder">1. Sentence Builder</h4>
<p><strong>Purpose:</strong> Learn grammar patterns through guided
construction.</p>
<p><strong>Exercise Types:</strong></p>
<p><strong>Scrambled Sentences:</strong></p>
<pre><code>Words: [el, manzana, comÃ­, ayer, la]
Build: &quot;Ayer comÃ­ la manzana.&quot;
Feedback: âœ… Perfect! (Subject-Verb-Object order)</code></pre>
<p><strong>Fill-in-the-Blank:</strong></p>
<pre><code>&quot;Gestern ____ ich einen Apfel.&quot; (essen)
Answer: &quot;Gestern aÃŸ ich einen Apfel.&quot;
Feedback: âœ… Correct past tense (PrÃ¤teritum)</code></pre>
<p><strong>Translation (Input â†’ Output):</strong></p>
<pre><code>L1: &quot;I would have gone if I had known.&quot;
L2: [User types French translation]
AI: Checks grammar + suggests alternatives</code></pre>
<h4 id="composition-studio">2. Composition Studio</h4>
<p><strong>Purpose:</strong> Write longer texts (paragraphs, essays)
with AI feedback.</p>
<p><strong>Workflow:</strong></p>
<pre><code>1. Choose topic: &quot;Describe your ideal weekend&quot;
2. Write freely (200-500 words)
3. Submit for analysis
4. Receive feedback:
   - Grammar errors (highlighted)
   - Vocabulary suggestions (synonyms for overused words)
   - Structure critique (intro-body-conclusion)
5. Revise + resubmit</code></pre>
<p><strong>AI Feedback Example:</strong></p>
<pre><code>Original: &quot;I like very much pizza. Is delicious.&quot;

Feedback:
âŒ Word order: &quot;I like pizza very much.&quot; (adverb placement)
âŒ Article missing: &quot;It is delicious.&quot;
ğŸ’¡ Richer vocabulary: &quot;I adore pizza. It&#39;s delectable.&quot;</code></pre>
<h4 id="daily-writing-challenges">3. Daily Writing Challenges</h4>
<p><strong>Purpose:</strong> Build writing habit through
micro-tasks.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Monday:</strong> Write 3 sentences using todayâ€™s
vocabulary</li>
<li><strong>Wednesday:</strong> Describe this image in 50 words (photo
provided)</li>
<li><strong>Friday:</strong> Write a letter to your future self (100
words)</li>
</ul>
<p><strong>Gamification:</strong></p>
<ul>
<li>7-day writing streak = +500 XP</li>
<li>Monthly challenge winner = Badge + featured on homepage</li>
</ul>
<hr />
<h2 id="reading-module">Reading Module</h2>
<h3 id="overview-3">Overview</h3>
<p>Massive comprehensible input through graded texts and authentic
content.</p>
<h3 id="features-1">Features</h3>
<h4 id="library-graded-readers">1. Library (Graded Readers)</h4>
<p><strong>Content Categories:</strong></p>
<ul>
<li>Short stories (5-10 min reads)</li>
<li>News articles (adapted for learners)</li>
<li>Book chapters (Harry Potter, classics in L2)</li>
<li>Blog posts (travel, tech, lifestyle)</li>
</ul>
<p><strong>Difficulty Grading:</strong></p>
<pre><code>AI analyzes text:
- Known vocabulary % (based on your vocab cards)
- Sentence complexity (clauses per sentence)
- Grammar structures (tenses, subjunctive, etc.)

Result:
ğŸŸ¢ Comfortable (98%+ known words)
ğŸŸ¡ Learning Zone (90-97% known)
ğŸ”´ Challenging (&lt;90% known)</code></pre>
<p><strong>Reading Interface:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“– El Principito - CapÃ­tulo 1              â”‚
â”‚  Level: B1 | ğŸ“Š 92% known words             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  Cuando yo tenÃ­a seis aÃ±os vi una vez una  â”‚
â”‚  magnÃ­fica [lÃ¡mina] en un libro...         â”‚
â”‚         â–²                                   â”‚
â”‚         â””â”€ Click word â†’ see definition     â”‚
â”‚            + Add to deck (one tap)          â”‚
â”‚                                             â”‚
â”‚  [Previous] [Bookmark] [Next]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Interactive Features:</strong></p>
<ul>
<li><strong>Click-to-define:</strong> Hover any word â†’ instant
translation</li>
<li><strong>Add to deck:</strong> Save unknown words â†’ auto-creates
flashcard</li>
<li><strong>Text-to-speech:</strong> Hear entire text (adjustable
speed)</li>
<li><strong>Progress tracking:</strong> Bookmarks, reading time, words
learned</li>
</ul>
<h4 id="sentence-mining-tool">2. Sentence Mining Tool</h4>
<p><strong>Purpose:</strong> Extract vocabulary from authentic content
YOU care about.</p>
<p><strong>Workflow:</strong></p>
<pre><code>1. Paste text (article, lyrics, book passage)
2. AI highlights words not in your deck
3. Select words to learn
4. AI generates flashcards with:
   - Word + definition
   - Original sentence (context)
   - Audio pronunciation
5. Cards added to deck &quot;Mined from [Source Name]&quot;</code></pre>
<p><strong>Example:</strong></p>
<pre><code>Input text: &quot;Le chat noir dormait sur le canapÃ©.&quot;

Unknown words: canapÃ©

Generated card:
Front: &quot;canapÃ©&quot;
Back: &quot;sofa / couch&quot;
Context: &quot;Le chat noir dormait sur le canapÃ©.&quot;
Audio: [ğŸ”Š native speaker]</code></pre>
<h4 id="parallel-texts">3. Parallel Texts</h4>
<p><strong>Purpose:</strong> Read L2 text with optional L1 translation
side-by-side.</p>
<p><strong>Interface:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spanish (L2)    â”‚  English (L1)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Era una noche   â”‚  It was a dark   â”‚
â”‚  oscura y        â”‚  and stormy      â”‚
â”‚  tormentosa.     â”‚  night.          â”‚
â”‚                  â”‚                  â”‚
â”‚  [Hidden by default â†’               â”‚
â”‚   Click to reveal if stuck]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Best Practice:</strong></p>
<ul>
<li>Read L2 paragraph first (comprehension test)</li>
<li>Only check L1 if completely lost</li>
<li>Goal: Wean off L1 over time</li>
</ul>
<hr />
<h2 id="listening-module">Listening Module</h2>
<h3 id="overview-4">Overview</h3>
<p>Train your ear through progressive listening challengesâ€”from scripted
dialogues to authentic podcasts.</p>
<h3 id="tools-2">Tools</h3>
<h4 id="dialogue-practice">1. Dialogue Practice</h4>
<p><strong>Purpose:</strong> Master conversational listening.</p>
<p><strong>Content:</strong></p>
<ul>
<li>Coffee shop orders</li>
<li>Doctor appointments</li>
<li>Job interviews</li>
<li>Casual friend chats</li>
</ul>
<p><strong>Exercise Flow:</strong></p>
<pre><code>1. Listen to 30s dialogue (no text)
2. Answer comprehension questions:
   - &quot;What did Maria order?&quot;
   - &quot;Why is Carlos late?&quot;
3. Listen again with transcript
4. Repeat until 80%+ comprehension</code></pre>
<p><strong>Difficulty Adjustments:</strong></p>
<ul>
<li>Speed: 0.7x (beginner) â†’ 1.0x (intermediate) â†’ 1.3x (advanced)</li>
<li>Accent: Standard â†’ regional dialects</li>
<li>Background noise: Clean audio â†’ cafÃ© ambiance</li>
</ul>
<h4 id="podcast-library">2. Podcast Library</h4>
<p><strong>Purpose:</strong> Consume authentic content for advanced
learners.</p>
<p><strong>Categories:</strong></p>
<ul>
<li><strong>Learner Podcasts:</strong> Slow speech, clear enunciation
(Coffee Break Spanish, etc.)</li>
<li><strong>Native Content:</strong> True crime, comedy, news
(real-world listening)</li>
</ul>
<p><strong>Features:</strong></p>
<ul>
<li>Transcript toggle (on/off)</li>
<li>Adjustable playback speed</li>
<li>Bookmarking (save position + timestamp note)</li>
<li>Vocabulary extraction (mine words from episodes)</li>
</ul>
<p><strong>Recommended Strategy:</strong></p>
<pre><code>Beginner (A1-A2):
  â””â”€ Learner podcasts only (100% comprehension goal)

Intermediate (B1-B2):
  â””â”€ 70% learner, 30% native content (focus on gist)

Advanced (C1-C2):
  â””â”€ 100% native content (full comprehension + idioms)</code></pre>
<h4 id="dictation-exercises">3. Dictation Exercises</h4>
<p><strong>Purpose:</strong> Test listening precision.</p>
<p><strong>How It Works:</strong></p>
<pre><code>1. Hear sentence: &quot;Je voudrais un cafÃ©, s&#39;il vous plaÃ®t.&quot;
2. Type what you heard (no replay)
3. Submit
4. AI compares:
   âœ… Correct: 100%
   âš ï¸  Minor typo: &quot;Je voudrais un cafe&quot; (95%, missing accent)
   âŒ Significant error: &quot;Je voodray un cafÃ©&quot; (60%)
5. Replay + see correct text</code></pre>
<p><strong>Difficulty Levels:</strong></p>
<ul>
<li><strong>L1:</strong> Single sentences (8-12 words)</li>
<li><strong>L2:</strong> Short paragraphs (50 words)</li>
<li><strong>L3:</strong> News clips (200 words, normal speed)</li>
</ul>
<hr />
<h2 id="design-system">Design System: Quiet Immersion</h2>
<h3 id="philosophy">Philosophy</h3>
<blockquote>
<p><strong>â€œLearning should feel like breathing â€” effortless, private,
and deeply satisfying.â€</strong></p>
</blockquote>
<p><strong>Goals:</strong></p>
<ol type="1">
<li><strong>Zero eye strain</strong> â†’ Dark mode default, low blue
light</li>
<li><strong>Zero distraction</strong> â†’ Single-focus layouts, no
clutter</li>
<li><strong>Zero friction</strong> â†’ Keyboard shortcuts, instant load
times</li>
<li><strong>Maximum immersion</strong> â†’ Floating cards, spatial
depth</li>
</ol>
<hr />
<h3 id="color-palette">Color Palette</h3>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 19%" />
<col style="width: 25%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr>
<th>Role</th>
<th>Color</th>
<th>Hex</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Background</strong></td>
<td>Void Black</td>
<td><code>#0a0a0a</code></td>
<td>Main canvas</td>
</tr>
<tr>
<td><strong>Card Base</strong></td>
<td>Deep Indigo Glass</td>
<td><code>rgba(30, 27, 75, 0.6)</code></td>
<td>Content containers</td>
</tr>
<tr>
<td><strong>Text (Primary)</strong></td>
<td>Frost White</td>
<td><code>#f8fafc</code></td>
<td>Body text</td>
</tr>
<tr>
<td><strong>Text (Secondary)</strong></td>
<td>Slate Gray</td>
<td><code>#94a3b8</code></td>
<td>Labels, metadata</td>
</tr>
<tr>
<td><strong>Accent (Success)</strong></td>
<td>Soft Cyan</td>
<td><code>#67e8f9</code></td>
<td>Correct answers, progress</td>
</tr>
<tr>
<td><strong>Accent (Warm)</strong></td>
<td>Muted Amber</td>
<td><code>#fbbf24</code></td>
<td>XP, achievements</td>
</tr>
<tr>
<td><strong>Accent (Error)</strong></td>
<td>Soft Coral</td>
<td><code>#fb7185</code></td>
<td>Wrong answers (not harsh red)</td>
</tr>
<tr>
<td><strong>Borders</strong></td>
<td>Dark Slate</td>
<td><code>#1e293b</code></td>
<td>Subtle dividers</td>
</tr>
</tbody>
</table>
<p><strong>Glassmorphism Effect:</strong></p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.card</span> {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background</span><span class="ch">:</span> <span class="fu">rgba(</span><span class="dv">30</span><span class="op">,</span> <span class="dv">27</span><span class="op">,</span> <span class="dv">75</span><span class="op">,</span> <span class="dv">0.6</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">backdrop-filter</span><span class="ch">:</span> <span class="fu">blur(</span><span class="dv">12</span><span class="dt">px</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">8</span><span class="dt">px</span> <span class="dv">32</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.4</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h3 id="typography">Typography</h3>
<p><strong>Font Stack:</strong></p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&quot;Inter&quot;</span><span class="op">,</span> <span class="dv">-apple-system</span><span class="op">,</span> <span class="dv">BlinkMacSystemFont</span><span class="op">,</span> <span class="st">&quot;Segoe UI&quot;</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">16</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>h1<span class="op">,</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>h2<span class="op">,</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>h3 {</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&quot;Clash Display&quot;</span><span class="op">,</span> <span class="st">&quot;SF Pro Rounded&quot;</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Scale:</strong></p>
<ul>
<li><strong>Body:</strong> 16px (mobile), 18px (desktop)</li>
<li><strong>Small:</strong> 14px (labels, metadata)</li>
<li><strong>H3:</strong> 20px (card titles)</li>
<li><strong>H2:</strong> 28px (page headers)</li>
<li><strong>H1:</strong> 36px (hero text)</li>
</ul>
<p><strong>Multilingual Support:</strong></p>
<ul>
<li><strong>Arabic:</strong> Line-height 1.8 (taller for
diacritics)</li>
<li><strong>CJK:</strong> Use Noto Sans CJK
(Chinese/Japanese/Korean)</li>
<li><strong>RTL languages:</strong> Auto-flip layout with
<code>dir="rtl"</code></li>
</ul>
<hr />
<h3 id="layout-system">Layout System</h3>
<p><strong>Grid:</strong></p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">480</span><span class="dt">px</span><span class="op">;</span> <span class="co">/* Mobile-first */</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="im">@media</span> <span class="fu">(</span><span class="kw">min-width</span><span class="ch">:</span> <span class="dv">768</span><span class="dt">px</span><span class="fu">)</span> {</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.container</span> {</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">720</span><span class="dt">px</span><span class="op">;</span> <span class="co">/* Tablet */</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="im">@media</span> <span class="fu">(</span><span class="kw">min-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="fu">)</span> {</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.container</span> {</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1080</span><span class="dt">px</span><span class="op">;</span> <span class="co">/* Desktop: Side-by-side modules */</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Card Anatomy:</strong></p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.card</span> {</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin-bottom</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">transition</span><span class="ch">:</span> <span class="dv">transform 0.2</span><span class="dt">s</span> <span class="dv">ease</span><span class="op">;</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">.card</span><span class="in">:hover</span> {</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">transform</span><span class="ch">:</span> <span class="fu">translateY(</span><span class="dv">-4</span><span class="dt">px</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">12</span><span class="dt">px</span> <span class="dv">48</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.6</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Spacing Scale:</strong></p>
<pre><code>0.25rem â†’ 4px   (tight elements)
0.5rem  â†’ 8px   (form fields)
1rem    â†’ 16px  (related items)
1.5rem  â†’ 24px  (cards, sections)
3rem    â†’ 48px  (major sections)</code></pre>
<hr />
<h3 id="ui-components">UI Components</h3>
<h4 id="flashcard-vocabulary-module">1. Flashcard (Vocabulary
Module)</h4>
<pre class="tsx"><code>&lt;div className=&quot;flashcard&quot;&gt;
  &lt;div className=&quot;flashcard-front&quot;&gt;
    &lt;h2&gt;La manzana&lt;/h2&gt;
    &lt;button className=&quot;audio-btn&quot;&gt;ğŸ”Š&lt;/button&gt;
  &lt;/div&gt;

  &lt;div className=&quot;flashcard-back&quot;&gt;
    &lt;p className=&quot;definition&quot;&gt;The apple&lt;/p&gt;
    &lt;p className=&quot;context&quot;&gt;&quot;ComÃ­ una manzana ayer.&quot;&lt;/p&gt;

    &lt;div className=&quot;rating-buttons&quot;&gt;
      &lt;button className=&quot;rating rating-again&quot;&gt;Again&lt;/button&gt;
      &lt;button className=&quot;rating rating-hard&quot;&gt;Hard&lt;/button&gt;
      &lt;button className=&quot;rating rating-good&quot;&gt;Good&lt;/button&gt;
      &lt;button className=&quot;rating rating-easy&quot;&gt;Easy&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>Visual:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚        La manzana  ğŸ”Š           â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â¬‡ï¸  (flip animation)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  The apple                      â”‚
â”‚  &quot;ComÃ­ una manzana ayer.&quot;       â”‚
â”‚                                 â”‚
â”‚  [Again] [Hard] [Good] [Easy]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="progress-vine-persistent-ui-element">2. Progress Vine
(Persistent UI Element)</h4>
<p><strong>Concept:</strong> A growing vine (SVG) on the left sidebar
that visualizes long-term progress.</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode svg"><code class="sourceCode xml"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">svg</span> <span class="ot">id=</span><span class="st">&quot;progress-vine&quot;</span> <span class="ot">width=</span><span class="st">&quot;60&quot;</span> <span class="ot">height=</span><span class="st">&quot;100%&quot;</span>&gt;</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">path</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">d=</span><span class="st">&quot;M30,0 Q40,100 30,200 Q20,300 30,400&quot;</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">stroke=</span><span class="st">&quot;#67e8f9&quot;</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">stroke-width=</span><span class="st">&quot;3&quot;</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">fill=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">stroke-dasharray=</span><span class="st">&quot;1000&quot;</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">stroke-dashoffset=</span><span class="st">&quot;800&quot;</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;!--</span><span class="co"> Animates as user progresses --&gt;</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  /&gt;</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Leaves = milestones (10 cards, 50 cards, 100 cards) --&gt;</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">circle</span> <span class="ot">cx=</span><span class="st">&quot;30&quot;</span> <span class="ot">cy=</span><span class="st">&quot;100&quot;</span> <span class="ot">r=</span><span class="st">&quot;8&quot;</span> <span class="ot">fill=</span><span class="st">&quot;#10b981&quot;</span> /&gt;</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">circle</span> <span class="ot">cx=</span><span class="st">&quot;30&quot;</span> <span class="ot">cy=</span><span class="st">&quot;200&quot;</span> <span class="ot">r=</span><span class="st">&quot;8&quot;</span> <span class="ot">fill=</span><span class="st">&quot;#fbbf24&quot;</span> /&gt;</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">svg</span>&gt;</span></code></pre></div>
<p><strong>Growth Logic:</strong></p>
<ul>
<li>Vine height = Total XP / 100</li>
<li>Leaf appears every 1000 XP</li>
<li>Vine color shifts: Cyan (beginner) â†’ Emerald (intermediate) â†’ Gold
(advanced)</li>
</ul>
<h4 id="ai-avatar-bottom-right-corner">3. AI Avatar (Bottom-Right
Corner)</h4>
<p><strong>Purpose:</strong> Subtle companion that reacts to user
actions.</p>
<p><strong>Appearance:</strong></p>
<ul>
<li>2.5D stylized face (SVG-based)</li>
<li>Minimal features (eyes, smile)</li>
<li>Soft glow around avatar</li>
</ul>
<p><strong>Reactions:</strong> | Event | Avatar Response | |â€”â€”-|â€”â€”â€”â€”â€”-|
| Correct answer | Eyes close briefly (contentment), smile widens | |
Wrong answer | Head tilts (empathy), no judgment | | Streak milestone |
Subtle sparkle animation | | Session complete | Gentle nod, eyes glow
cyan |</p>
<p><strong>Implementation:</strong></p>
<pre class="tsx"><code>&lt;div className=&quot;ai-avatar&quot;&gt;
  &lt;svg viewBox=&quot;0 0 100 100&quot;&gt;
    &lt;!-- Eyes (animate based on state) --&gt;
    &lt;circle cx=&quot;35&quot; cy=&quot;40&quot; r=&quot;8&quot; fill=&quot;#67e8f9&quot; className=&quot;eye-left&quot; /&gt;
    &lt;circle cx=&quot;65&quot; cy=&quot;40&quot; r=&quot;8&quot; fill=&quot;#67e8f9&quot; className=&quot;eye-right&quot; /&gt;

    &lt;!-- Smile (path morphs) --&gt;
    &lt;path
      d=&quot;M30,60 Q50,70 70,60&quot;
      stroke=&quot;#f8fafc&quot;
      stroke-width=&quot;3&quot;
      fill=&quot;none&quot;
      className=&quot;smile&quot;
    /&gt;
  &lt;/svg&gt;
&lt;/div&gt;</code></pre>
<h4 id="daily-goal-widget">4. Daily Goal Widget</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Today&#39;s Goal: 20 cards             â”‚
â”‚                                     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  60% (12/20)    â”‚
â”‚                                     â”‚
â”‚  ğŸ”¥ 3-day streak                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<hr />
<h3 id="micro-interactions">Micro-Interactions</h3>
<p><strong>1. Card Flip Animation:</strong></p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.flashcard</span> {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">transition</span><span class="ch">:</span> <span class="dv">transform 0.6</span><span class="dt">s</span><span class="op">;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">transform-style</span><span class="ch">:</span> <span class="dv">preserve-3d</span><span class="op">;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">.flashcard.flipped</span> {</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">transform</span><span class="ch">:</span> <span class="fu">rotateY(</span><span class="dv">180</span><span class="dt">deg</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>2. Correct Answer Pulse:</strong></p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">@keyframes</span> success-pulse {</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0%</span> {</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">transform</span><span class="ch">:</span> <span class="fu">scale(</span><span class="dv">1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50%</span> {</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">transform</span><span class="ch">:</span> <span class="fu">scale(</span><span class="dv">1.05</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">20</span><span class="dt">px</span> <span class="cn">#67e8f9</span><span class="op">;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100%</span> {</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">transform</span><span class="ch">:</span> <span class="fu">scale(</span><span class="dv">1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="fu">.card.correct</span> {</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">animation</span><span class="ch">:</span> <span class="dv">success-pulse 0.3</span><span class="dt">s</span> <span class="dv">ease</span><span class="op">;</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>3. Haptic Feedback (Mobile):</strong></p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">// On correct answer</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="bu">navigator</span><span class="op">.</span><span class="fu">vibrate</span>(<span class="dv">30</span>)<span class="op">;</span> <span class="co">// Short tick</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">// On wrong answer</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="bu">navigator</span><span class="op">.</span><span class="fu">vibrate</span>([<span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">50</span>])<span class="op">;</span> <span class="co">// Double tap</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">// On milestone</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="bu">navigator</span><span class="op">.</span><span class="fu">vibrate</span>([<span class="dv">100</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">200</span>])<span class="op">;</span> <span class="co">// Celebration pattern</span></span></code></pre></div>
<p><strong>4. Spatial Audio:</strong></p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> audio <span class="op">=</span> {</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">correct</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Audio</span>(<span class="st">&quot;/sounds/chime-soft.mp3&quot;</span>)<span class="op">,</span> <span class="co">// 440Hz, 0.2s</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">incorrect</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Audio</span>(<span class="st">&quot;/sounds/thud-soft.mp3&quot;</span>)<span class="op">,</span> <span class="co">// 220Hz, 0.3s</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">milestone</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Audio</span>(<span class="st">&quot;/sounds/bell-warm.mp3&quot;</span>)<span class="op">,</span> <span class="co">// Harmonious chord</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>audio<span class="op">.</span><span class="at">correct</span><span class="op">.</span><span class="at">volume</span> <span class="op">=</span> <span class="fl">0.3</span><span class="op">;</span> <span class="co">// Subtle, not jarring</span></span></code></pre></div>
<hr />
<h3 id="accessibility">Accessibility</h3>
<p><strong>WCAG AAA Compliance:</strong></p>
<ul>
<li><strong>Color contrast:</strong> 4.5:1 minimum (body text)</li>
<li><strong>Focus indicators:</strong> 3px cyan outline on interactive
elements</li>
<li><strong>Keyboard navigation:</strong> Tab through all actions</li>
<li><strong>Screen reader:</strong> ARIA labels on all
icons/buttons</li>
</ul>
<p><strong>Reduce Motion:</strong></p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">@media</span> <span class="fu">(</span><span class="kw">prefers-reduced-motion</span><span class="ch">:</span> <span class="dv">reduce</span><span class="fu">)</span> {</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">*</span> {</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">animation-duration</span><span class="ch">:</span> <span class="dv">0.01</span><span class="dt">ms</span> <span class="at">!important</span><span class="op">;</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">transition-duration</span><span class="ch">:</span> <span class="dv">0.01</span><span class="dt">ms</span> <span class="at">!important</span><span class="op">;</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Font Scaling:</strong></p>
<ul>
<li>Respect userâ€™s OS font size setting</li>
<li>Allow in-app text size adjustment (Settings)</li>
</ul>
<hr />
<h3 id="performance-targets">Performance Targets</h3>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 23%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>First Contentful Paint</strong></td>
<td>&lt; 1.2s</td>
<td>User sees content fast</td>
</tr>
<tr>
<td><strong>Largest Contentful Paint</strong></td>
<td>&lt; 2.5s</td>
<td>Main content loaded</td>
</tr>
<tr>
<td><strong>Time to Interactive</strong></td>
<td>&lt; 3.0s</td>
<td>User can act quickly</td>
</tr>
<tr>
<td><strong>JavaScript Bundle</strong></td>
<td>&lt; 150KB</td>
<td>Fast on 3G networks</td>
</tr>
<tr>
<td><strong>Image Optimization</strong></td>
<td>WebP, lazy load</td>
<td>Reduce bandwidth</td>
</tr>
</tbody>
</table>
<p><strong>Optimization Strategies:</strong></p>
<ul>
<li>Code splitting per module (load Vocabulary separate from
Speaking)</li>
<li>Service worker for offline caching</li>
<li>CDN for audio/image assets</li>
<li>Database query caching (Redis)</li>
</ul>
<hr />
<h2 id="gamification-strategy">Gamification Strategy</h2>
<h3 id="philosophy-1">Philosophy</h3>
<blockquote>
<p><strong>â€œGamification should reward learning, not just logging
in.â€</strong></p>
</blockquote>
<p><strong>What We Avoid:</strong></p>
<ul>
<li>âŒ Daily login bonuses (encourages empty sessions)</li>
<li>âŒ Pay-to-skip mechanics (undermines learning)</li>
<li>âŒ Public shaming (leaderboards showing â€œworstâ€ performers)</li>
</ul>
<p><strong>What We Embrace:</strong></p>
<ul>
<li>âœ… Mastery-based XP (more XP for difficult cards)</li>
<li>âœ… Intrinsic rewards (seeing your vine grow)</li>
<li>âœ… Collaborative goals (study with friends)</li>
</ul>
<hr />
<h3 id="xp-system">XP System</h3>
<p><strong>XP Sources:</strong></p>
<table>
<colgroup>
<col style="width: 51%" />
<col style="width: 12%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr>
<th>Action</th>
<th>XP Earned</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>Review card (Good)</td>
<td>10 XP</td>
<td>Base reward</td>
</tr>
<tr>
<td>Review card (Hard)</td>
<td>15 XP</td>
<td>More effort = more reward</td>
</tr>
<tr>
<td>Review card (Easy)</td>
<td>5 XP</td>
<td>Too easy = less learning</td>
</tr>
<tr>
<td>Complete 20-card session</td>
<td>50 XP</td>
<td>Consistency bonus</td>
</tr>
<tr>
<td>7-day streak maintained</td>
<td>200 XP</td>
<td>Building habit</td>
</tr>
<tr>
<td>Shadowing exercise (&gt;80% score)</td>
<td>30 XP</td>
<td>Output practice</td>
</tr>
<tr>
<td>Write 100-word composition</td>
<td>40 XP</td>
<td>Deep engagement</td>
</tr>
<tr>
<td>Read article (5+ min)</td>
<td>25 XP</td>
<td>Input practice</td>
</tr>
<tr>
<td>Create public deck (&gt;10 subscribers)</td>
<td>500 XP</td>
<td>Community contribution</td>
</tr>
</tbody>
</table>
<p><strong>XP Decay Prevention:</strong></p>
<ul>
<li>No XP loss for missing days (no punishment)</li>
<li>Bonus XP for returning after 3+ day break (encouragement)</li>
</ul>
<p><strong>Level System:</strong></p>
<pre><code>Level 1:      0 -   500 XP  (Seedling ğŸŒ±)
Level 2:    500 - 1,500 XP  (Sprout ğŸŒ¿)
Level 5:  5,000 - 10,000 XP (Tree ğŸŒ³)
Level 10: 25,000 - 50,000 XP (Forest ğŸŒ²)</code></pre>
<hr />
<h3 id="streaks">Streaks</h3>
<p><strong>Definition:</strong> Consecutive days with at least 1
completed study session.</p>
<p><strong>Visualization:</strong></p>
<pre><code>ğŸ”¥ 14-day streak

Week 1: âœ…âœ…âœ…âœ…âœ…âœ…âœ…
Week 2: âœ…âœ…âœ…âœ…âœ…âœ…âœ…
Today:  â† 2 hours left to maintain streak!</code></pre>
<p><strong>Streak Freezes:</strong></p>
<ul>
<li>Earn 1 freeze per 7-day streak</li>
<li>Use freeze to skip 1 day without breaking streak</li>
<li>Max 2 freezes stored</li>
</ul>
<p><strong>Milestones:</strong></p>
<ul>
<li>7 days: +200 XP, â€œWeek Warriorâ€ badge</li>
<li>30 days: +1000 XP, â€œMonthly Maestroâ€ badge</li>
<li>100 days: +5000 XP, â€œCenturionâ€ badge, custom avatar frame</li>
</ul>
<hr />
<h3 id="badges">Badges</h3>
<p><strong>Categories:</strong></p>
<p><strong>1. Consistency Badges:</strong></p>
<ul>
<li>ğŸŒŸ <strong>First Steps:</strong> Complete 1st study session</li>
<li>ğŸ”¥ <strong>Week Warrior:</strong> 7-day streak</li>
<li>ğŸ“… <strong>Monthly Maestro:</strong> 30-day streak</li>
<li>ğŸ’ <strong>Century Club:</strong> 100-day streak</li>
</ul>
<p><strong>2. Mastery Badges:</strong></p>
<ul>
<li>ğŸ“š <strong>Vocab Novice:</strong> Review 100 cards</li>
<li>ğŸ“– <strong>Vocab Scholar:</strong> Review 1,000 cards</li>
<li>ğŸ“ <strong>Vocab Master:</strong> Review 10,000 cards</li>
<li>ğŸ—£ï¸ <strong>Pronunciation Pro:</strong> 50 shadowing exercises
(&gt;80% score)</li>
<li>âœï¸ <strong>Writerâ€™s Guild:</strong> Write 10,000 words total</li>
</ul>
<p><strong>3. Social Badges:</strong></p>
<ul>
<li>ğŸ‘¥ <strong>Deck Creator:</strong> Publish 1st public deck</li>
<li>â­ <strong>Community Star:</strong> Your deck reaches 100
subscribers</li>
<li>ğŸ¤ <strong>Study Buddy:</strong> Complete 10 co-study sessions with
friends</li>
</ul>
<p><strong>4. Special Badges:</strong></p>
<ul>
<li>ğŸŒ™ <strong>Night Owl:</strong> Study session at 2-4am</li>
<li>ğŸŒ <strong>Polyglot Path:</strong> Study 3+ languages in
platform</li>
<li>ğŸ† <strong>Leaderboard Legend:</strong> Top 10 in monthly XP</li>
</ul>
<p><strong>Display:</strong></p>
<ul>
<li>Profile page: Showcase up to 6 favorite badges</li>
<li>Badge cabinet: View all earned badges (grayed out = locked)</li>
</ul>
<hr />
<h3 id="leaderboards">Leaderboards</h3>
<p><strong>Types:</strong></p>
<p><strong>1. Global Leaderboard (Monthly):</strong></p>
<pre><code>Rank  User           XP This Month
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1   ğŸ¥‡ Sarah        15,240 XP
  2   ğŸ¥ˆ Miguel       14,890 XP
  3   ğŸ¥‰ Yuki         13,750 XP
...
 42   You             8,120 XP</code></pre>
<p><strong>2. Friends Leaderboard:</strong></p>
<pre><code>Among your 12 friends:

  1   Alex           3,450 XP
  2   You            3,210 XP
  3   Jamie          2,980 XP</code></pre>
<p><strong>3. Language-Specific:</strong></p>
<pre><code>Top Spanish Learners (This Week):

  1   Carlos         2,100 XP
  2   You            1,850 XP</code></pre>
<p><strong>Privacy:</strong></p>
<ul>
<li>Opt-out option (hide from global leaderboard)</li>
<li>Only show first name + last initial (e.g., â€œSarah M.â€)</li>
<li>Friends leaderboard requires mutual follow</li>
</ul>
<hr />
<h3 id="progress-visualization">Progress Visualization</h3>
<p><strong>1. Module Progress Rings:</strong></p>
<pre><code>Dashboard shows 5 rings (one per module):

   Vocabulary  Speaking  Writing  Reading  Listening
      88%        45%       23%      67%       34%</code></pre>
<p><strong>2. Language Proficiency Estimate:</strong></p>
<pre><code>Spanish Proficiency: B1 (Intermediate)

ğŸ“Š Breakdown:
- Vocabulary: 1,842 words known (B1: 1,500-2,500)
- Grammar: 78% accuracy on B1 structures
- Listening: 85% comprehension on B1 audio
- Speaking: Estimated B1 (based on AI conversations)

ğŸ¯ Next milestone: B2 (need 658 more words)</code></pre>
<p><strong>3. Time Investment Graph:</strong></p>
<pre><code>Study Time This Month: 14h 32m

   Hours
    8 â”¤     â•­â”€â”€â”€â—
    6 â”¤   â•­â”€â•¯
    4 â”¤ â•­â”€â•¯
    2 â”¤â”€â•¯
    0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      Week 1  2  3  4</code></pre>
<hr />
<h2 id="ai-personalization">AI &amp; Personalization</h2>
<h3 id="learning-profile">Learning Profile</h3>
<p><strong>System tracks:</strong></p>
<ul>
<li><strong>Vocabulary size</strong> (per language)</li>
<li><strong>Grammar competency</strong> (which structures mastered)</li>
<li><strong>Preferred content</strong> (topics: sports, tech, food,
etc.)</li>
<li><strong>Optimal study time</strong> (morning person vs.Â night
owl)</li>
<li><strong>Review patterns</strong> (FSRS difficulty parameters)</li>
</ul>
<p><strong>Adaptive Content Recommendations:</strong></p>
<pre><code>&quot;Based on your progress, we recommend:
- ğŸ“– Reading: &#39;El Alchemista&#39; (90% known vocabulary)
- ğŸ§ Podcast: &#39;Coffee Break Spanish&#39; Episode 42
- ğŸ“ Writing: Practice present subjunctive (your weak area)</code></pre>
<h3 id="ai-features">AI Features</h3>
<p><strong>1. Smart Review Ordering:</strong></p>
<ul>
<li>Mix old + new cards (not all hard cards at end)</li>
<li>Interleave topics (vocabulary + grammar, not blocks)</li>
<li>Priority to cards near â€œforgetting thresholdâ€</li>
</ul>
<p><strong>2. Difficulty Auto-Adjustment:</strong></p>
<ul>
<li>Text too easy (&gt;98% comprehension) â†’ suggest harder texts</li>
<li>Speaking exercises too fast â†’ auto-slow to 0.8x</li>
</ul>
<p><strong>3. Personalized Study Plans:</strong></p>
<pre><code>Your goal: B2 Spanish in 6 months

Weekly plan:
- Monday/Wed/Fri: 30 min vocabulary review
- Tuesday/Thursday: 20 min speaking practice
- Weekends: 40 min reading + listening</code></pre>
<p><strong>4. AI Tutor (Future Feature):</strong></p>
<ul>
<li>Ask questions: â€œWhen do I use â€˜serâ€™ vs.Â â€˜estarâ€™?â€</li>
<li>Get explanations in your native language</li>
<li>Request custom exercises for weak areas</li>
</ul>
<hr />
<h2 id="roadmap">Roadmap</h2>
<h3 id="phase-1-mvp-q4-2025-in-progress">Phase 1: MVP (Q4 2025) âœ… In
Progress</h3>
<p><strong>Core Features:</strong></p>
<ul>
<li>âœ… User authentication (register, login, JWT)</li>
<li>âœ… Vocabulary module (FSRS flashcards)</li>
<li>âœ… Deck management (create, fork, commit)</li>
<li>âœ… Basic gamification (XP, streaks, levels)</li>
<li>ğŸš§ Speaking module (shadowing only)</li>
<li>ğŸš§ Reading module (graded texts library)</li>
</ul>
<p><strong>Tech Debt:</strong></p>
<ul>
<li>Finalize gRPC communication (Python â†”ï¸ ASP.NET)</li>
<li>Docker compose for local dev environment</li>
<li>CI/CD pipeline (GitHub Actions)</li>
</ul>
<hr />
<h3 id="phase-2-enhanced-modules-q1-2026">Phase 2: Enhanced Modules (Q1
2026)</h3>
<p><strong>New Features:</strong></p>
<ul>
<li>Listening module (podcast library, dictation)</li>
<li>Writing module (sentence builder, composition studio)</li>
<li>Speaking: Conversation simulator (AI partner)</li>
<li>Social features (friends, leaderboards, profile pages)</li>
</ul>
<p><strong>Design:</strong></p>
<ul>
<li>Full â€œQuiet Immersionâ€ UI implementation</li>
<li>AI avatar reactions</li>
<li>Progress vine animation</li>
<li>Mobile PWA (offline mode)</li>
</ul>
<hr />
<h3 id="phase-3-community-content-q2-2026">Phase 3: Community &amp;
Content (Q2 2026)</h3>
<p><strong>Marketplace:</strong></p>
<ul>
<li>Public deck discovery (search, filters, ratings)</li>
<li>Deck versioning UI (commit history, diffs, merge)</li>
<li>Creator analytics (subscriber count, review stats)</li>
</ul>
<p><strong>User-Generated Content:</strong></p>
<ul>
<li>Import tool (Anki, CSV, Quizlet)</li>
<li>Bulk sentence mining (paste article â†’ auto-generate cards)</li>
<li>Image/audio uploads for custom cards</li>
</ul>
<p><strong>Monetization (Optional):</strong></p>
<ul>
<li>Premium tier ($5/mo):
<ul>
<li>Unlimited decks (free: 5 decks max)</li>
<li>Advanced stats (granular progress graphs)</li>
<li>Priority AI features (faster pronunciation scoring)</li>
</ul></li>
<li>Keep core learning free forever</li>
</ul>
<hr />
<h3 id="phase-4-advanced-ai-q3-2026">Phase 4: Advanced AI (Q3 2026)</h3>
<p><strong>AI Tutor:</strong></p>
<ul>
<li>Chat with AI in target language (Socratic method)</li>
<li>Grammar explanations on-demand</li>
<li>Personalized study plan generator</li>
</ul>
<p><strong>Content Intelligence:</strong></p>
<ul>
<li>Auto-generate decks from YouTube videos (extract subtitles)</li>
<li>Podcast transcription + vocabulary extraction</li>
<li>Adaptive text difficulty (AI rewrites texts to your level)</li>
</ul>
<p><strong>Speech Tech:</strong></p>
<ul>
<li>Real-time pronunciation feedback during shadowing</li>
<li>Accent training (British vs.Â American English)</li>
<li>Emotion detection (are you confident or hesitant?)</li>
</ul>
<hr />
<h3 id="phase-5-mobile-apps-q4-2026">Phase 5: Mobile Apps (Q4 2026)</h3>
<p><strong>Native iOS/Android:</strong></p>
<ul>
<li>Offline study mode (sync when online)</li>
<li>Widgets (daily goal progress, streak counter)</li>
<li>Push notifications (gentle reminders, not spam)</li>
<li>Voice-first interface (study while commuting)</li>
</ul>
<p><strong>Wearables:</strong></p>
<ul>
<li>Apple Watch: Quick reviews during breaks</li>
<li>Smart speakers: â€œAlexa, quiz me on Spanish vocabâ€</li>
</ul>
<hr />
<h2 id="success-metrics">Success Metrics</h2>
<h3 id="learning-outcomes-primary">Learning Outcomes (Primary)</h3>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 30%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Measurement</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vocabulary retention</strong></td>
<td>85%+ after 30 days</td>
<td>FSRS data (cards due vs.Â cards remembered)</td>
</tr>
<tr>
<td><strong>User-reported fluency gain</strong></td>
<td>+1 CEFR level per 6 months</td>
<td>Self-assessment survey</td>
</tr>
<tr>
<td><strong>Active study rate</strong></td>
<td>60% of users study 3+ days/week</td>
<td>Session logs</td>
</tr>
</tbody>
</table>
<h3 id="engagement-secondary">Engagement (Secondary)</h3>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 27%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Measurement</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>7-day retention</strong></td>
<td>50%</td>
<td>Users who return after 1 week</td>
</tr>
<tr>
<td><strong>30-day retention</strong></td>
<td>30%</td>
<td>Users still active after 1 month</td>
</tr>
<tr>
<td><strong>Average session length</strong></td>
<td>15-20 minutes</td>
<td>Time from start to end of study session</td>
</tr>
<tr>
<td><strong>Daily active users (DAU)</strong></td>
<td>Grow 10% month-over-month</td>
<td>Login events per day</td>
</tr>
</tbody>
</table>
<h3 id="community-tertiary">Community (Tertiary)</h3>
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 30%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Measurement</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Public decks created</strong></td>
<td>1,000+ in Year 1</td>
<td>Deck publish events</td>
</tr>
<tr>
<td><strong>Deck forks</strong></td>
<td>20% of public decks forked</td>
<td>Fork action count</td>
</tr>
<tr>
<td><strong>Average deck rating</strong></td>
<td>4.2+ / 5 stars</td>
<td>User ratings (after studying deck)</td>
</tr>
</tbody>
</table>
<h3 id="technical-infrastructure">Technical (Infrastructure)</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Current</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API response time</strong></td>
<td>&lt; 200ms (p95)</td>
<td>Monitor with Datadog/Grafana</td>
</tr>
<tr>
<td><strong>Uptime</strong></td>
<td>99.5%</td>
<td>Exclude planned maintenance</td>
</tr>
<tr>
<td><strong>Mobile load time</strong></td>
<td>&lt; 2s (LCP)</td>
<td>Lighthouse CI scores</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p><strong>LineByLine</strong> is not just another language appâ€”itâ€™s a
<strong>scientifically-grounded learning ecosystem</strong> that
respects usersâ€™ time, intelligence, and goals.</p>
<h3 id="what-makes-us-different">What Makes Us Different</h3>
<ol type="1">
<li><strong>Science over engagement hacks</strong> â€” FSRS,
comprehensible input, output practice</li>
<li><strong>Modular mastery</strong> â€” Focus on one skill deeply, not
shallow â€œgamifiedâ€ lessons</li>
<li><strong>Community-driven content</strong> â€” Git-like deck
versioning, public marketplace</li>
<li><strong>Privacy-first design</strong> â€” No data selling, no
manipulative streaks</li>
<li><strong>Beautiful, calming UI</strong> â€” â€œQuiet Immersionâ€ design
for distraction-free learning</li>
</ol>
<h3 id="our-promise">Our Promise</h3>
<blockquote>
<p><strong>â€œWe succeed when you become fluent, not when you open the app
100 days in a row.â€</strong></p>
</blockquote>
<hr />
<h2 id="appendices">Appendices</h2>
<h3 id="a.-glossary-of-language-learning-terms">A. Glossary of Language
Learning Terms</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CEFR</strong></td>
<td>Common European Framework of Reference (A1 â†’ C2)</td>
</tr>
<tr>
<td><strong>Comprehensible Input</strong></td>
<td>Language slightly above current level (i+1)</td>
</tr>
<tr>
<td><strong>Comprehensible Output</strong></td>
<td>Producing language to test hypotheses</td>
</tr>
<tr>
<td><strong>FSRS</strong></td>
<td>Free Spaced Repetition Scheduler (ML-based algorithm)</td>
</tr>
<tr>
<td><strong>Shadowing</strong></td>
<td>Repeating audio simultaneously to improve pronunciation</td>
</tr>
<tr>
<td><strong>SRS</strong></td>
<td>Spaced Repetition System (generic term)</td>
</tr>
<tr>
<td><strong>i+1</strong></td>
<td>Input at â€œcurrent level + 1 difficultyâ€</td>
</tr>
</tbody>
</table>
<h3 id="b.-recommended-reading">B. Recommended Reading</h3>
<ul>
<li><strong>â€œThe Natural Approachâ€</strong> by Stephen Krashen</li>
<li><strong>â€œHow Languages Are Learnedâ€</strong> by Patsy Lightbown</li>
<li><strong>â€œMake It Stickâ€</strong> by Peter Brown (learning
science)</li>
<li><strong>â€œFluent Foreverâ€</strong> by Gabriel Wyner (practical
methods)</li>
</ul>
<h3 id="c.-technical-documentation-links">C. Technical Documentation
Links</h3>
<ul>
<li><strong>FSRS Algorithm:</strong> <a
href="https://github.com/open-spaced-repetition/fsrs4anki">open-spaced-repetition/fsrs4anki</a></li>
<li><strong>gRPC Protocol:</strong>
<code>proto/fsrs_service.proto</code> (internal repo)</li>
<li><strong>API Endpoints:</strong> <code>docs/api-reference.md</code>
(internal repo)</li>
<li><strong>Design System:</strong> <code>docs/design-system.md</code>
(internal repo)</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> October 31, 2025<br />
<strong>Document Owner:</strong> LineByLine Product Team<br />
<strong>Contact:</strong> [project repository]</p>
<hr />
<p><em>This is a living document. As we learn from users and iterate on
features, weâ€™ll update this vision accordingly.</em></p>
</body>
</html>
